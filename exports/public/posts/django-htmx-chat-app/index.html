<!doctype html>
<html
  lang="en-us"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"><head>
  <meta charset="utf-8">
  
    <meta http-equiv="content-language" content="en-us">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color">

  
  
    <title>Creating a Chat Application with Django and HTMX &middot; Notes</title>
    <meta name="title" content="Creating a Chat Application with Django and HTMX &middot; Notes">
  

  
  
    <meta name="description" content="A collection of technical notes and posts">
  
  
    <meta name="keywords" content="django,htmx,python,">
  
  
  
  <link rel="canonical" href="/posts/django-htmx-chat-app/">
  

  
  
    <meta name="author" content="Meet Gor">
  
  

  
  <meta property="og:url" content="/posts/django-htmx-chat-app/">
  <meta property="og:site_name" content="Notes">
  <meta property="og:title" content="Creating a Chat Application with Django and HTMX">
  <meta property="og:description" content="Django &#43; HTMX Chat application # Introduction # In this article, we will be creating a Django project, which will be a chat-room kind of application. The user needs to authenticate to the app and then and there he/she can create or join rooms, every room will have some name and URL associated with it. So, the user simply needs to enter the name of the room, which will be unique. The user can then simply enter the messages in the chat room. This is a core chat application that uses web sockets.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-02-05T17:15:00+00:00">
    <meta property="article:modified_time" content="2026-01-04T15:49:51+05:30">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Creating a Chat Application with Django and HTMX">
  <meta name="twitter:description" content="Django &#43; HTMX Chat application # Introduction # In this article, we will be creating a Django project, which will be a chat-room kind of application. The user needs to authenticate to the app and then and there he/she can create or join rooms, every room will have some name and URL associated with it. So, the user simply needs to enter the name of the room, which will be unique. The user can then simply enter the messages in the chat room. This is a core chat application that uses web sockets.">

  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
  
    
  

  
  
  
  
  
  

  

  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.c61736128cfa071f52268b924e8b8c8dff7f9e962caae1e812053e9e023a4e1c1c95239d517406a4002933de9dd5ad84667956aa9d4230a25024e7e502058ca1.css"
    integrity="sha512-xhc2Eoz6Bx9SJouSTouMjf9/npYsquHoEgU&#43;ngI6ThwclSOdUXQGpAApM96d1a2EZnlWqp1CMKJQJOflAgWMoQ==">

  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js"
    integrity="sha512-b0EXSzoFtoCCD&#43;CMrb&#43;l&#43;3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script>
  
  
  
  
  
  
    
    <script src="/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js" integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7&#43;kfJ6kKCJxQGC&#43;8wm&#43;Bz9JucDjDTGNew=="></script>
  

  
  
  
    
  
  
    
  
  
  
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.67624a357c928d29b9fe19ba01a1e32c05ad1329ca2a712bf10446df0c6872903d0c14b21f76896b57a5a0710940805416cee38851d9067db6555881188e35a5.js"
      integrity="sha512-Z2JKNXySjSm5/hm6AaHjLAWtEynKKnEr8QRG3wxocpA9DBSyH3aJa1eloHEJQIBUFs7jiFHZBn22VViBGI41pQ=="
      data-copy="Copy"
      data-copied="Copied"></script>
  

  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>


























  

  

  

  

  








  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
  

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Creating a Chat Application with Django and HTMX",
    "headline": "Creating a Chat Application with Django and HTMX",
    
    "inLanguage": "en-us",
    "url" : "/posts/django-htmx-chat-app/",
    "author" : {
      "@type": "Person",
      "name": "Meet Gor"
    },
    "copyrightYear": "2023",
    "dateCreated": "2023-02-05T17:15:00\u002b00:00",
    "datePublished": "2023-02-05T17:15:00\u002b00:00",
    
    "dateModified": "2026-01-04T15:49:51\u002b05:30",
    
    "keywords": ["django","htmx","python"],
    
    "mainEntityOfPage": "true",
    "wordCount": "6459"
  }]
  </script>



  
  
    




  

  
  

  
  

  
  

  
  
</head>


















  
  <body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        Skip to main content
      </a>
    </div>
    
    
      <div class="main-menu flex items-center w-full gap-2 p-1 pl-0">
  
  
    <a href="/" class="text-base font-medium truncate min-w-0 shrink">
      Notes
    </a>
  
  <div class="flex items-center ms-auto">
    <div class="hidden md:flex">
      <nav class="flex items-center gap-x-5 h-12">
  
    
      
  
    <a
      href="/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="Home"
      title="">
      
      
        <span class="text-base font-medium break-normal">
          Home
        </span>
      
    </a>
  

    
      
  
    <a
      href="/posts/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="Posts"
      title="">
      
      
        <span class="text-base font-medium break-normal">
          Posts
        </span>
      
    </a>
  

    
      
  
    <a
      href="/tags/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="Tags"
      title="">
      
      
        <span class="text-base font-medium break-normal">
          Tags
        </span>
      
    </a>
  

    
  

  

  

  
    <button
      id="search-button"
      aria-label="Search"
      class="text-base bf-icon-color-hover"
      title="Search (/)">
      <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
    </button>
  

  
    <div class="flex items-center">
      <button
        id="appearance-switcher"
        aria-label="Dark mode switcher"
        type="button"
        class="text-base bf-icon-color-hover">
        <div class="flex items-center justify-center dark:hidden">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
        </div>
        <div class="items-center justify-center hidden dark:flex">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
        </div>
      </button>
    </div>
  
</nav>



    </div>
    <div class="flex md:hidden">
      <div class="flex items-center h-14 gap-4">
  
    <button
      id="search-button-mobile"
      aria-label="Search"
      class="flex items-center justify-center bf-icon-color-hover"
      title="Search (/)">
      <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
    </button>
  

  
    <button
      id="appearance-switcher-mobile"
      type="button"
      aria-label="Dark mode switcher"
      class="flex items-center justify-center text-neutral-900 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400">
      <div class="dark:hidden">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
      </div>
      <div class="hidden dark:block">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
      </div>
    </button>
  

  
    <input type="checkbox" id="mobile-menu-toggle" autocomplete="off" class="hidden peer">
    <label for="mobile-menu-toggle" class="flex items-center justify-center cursor-pointer bf-icon-color-hover">
      <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
    </label>

    <div
      role="dialog"
      aria-modal="true"
      style="scrollbar-gutter: stable;"
      class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
      bf-scrollbar">
      <label
        for="mobile-menu-toggle"
        class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </label>
      <nav class="mx-auto max-w-md space-y-6">
        
  
    
    <div class="px-2">
      <a
        href="/"
        aria-label="Home"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="" class="text-2xl font-bold tracking-tight">
          Home
        </span>
        
      </a>

      
    </div>
  
    
    <div class="px-2">
      <a
        href="/posts/"
        aria-label="Posts"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="" class="text-2xl font-bold tracking-tight">
          Posts
        </span>
        
      </a>

      
    </div>
  
    
    <div class="px-2">
      <a
        href="/tags/"
        aria-label="Tags"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="" class="text-2xl font-bold tracking-tight">
          Tags
        </span>
        
      </a>

      
    </div>
  

        
  

        
  

      </nav>
    </div>
  
</div>







    </div>
  </div>
</div>





    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  
  <article>
    
    

    
    <header id="single_header" class="mt-5 max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Creating a Chat Application with Django and HTMX
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  
    
  

  

  
    
  

  

  
    
  

  
    
  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2023-02-05T17:15:00&#43;00:00">February 5, 2023</time><span class="px-2 text-primary-500">&middot;</span><span>6459 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">31 mins</span>
    

    
    
  </div>

  

  
  

  
  



      </div>
      
        
  
  
  
  
  
  

  

  
    
    
<div class="flex author">
  
  <div class="place-self-center">
    
      <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
        Author
      </div>
      <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
        Meet Gor
      </div>
    
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>

  

  

  
    <div class="mb-5"></div>
  

      
    </header>

    
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
      
      
      
      


      <div class="min-w-0 min-h-0 max-w-fit">
        
        <div class="article-content max-w-prose mb-20">
          
<h1 class="relative group">Django + HTMX Chat application
    <div id="django--htmx-chat-application" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#django--htmx-chat-application" aria-label="Anchor">#</a>
    </span>
    
</h1>

<h2 class="relative group">Introduction
    <div id="introduction" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#introduction" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>In this article, we will be creating a Django project, which will be a chat-room kind of application. The user needs to authenticate to the app and then and there he/she can create or join rooms, every room will have some name and URL associated with it. So, the user simply needs to enter the name of the room, which will be unique. The user can then simply enter the messages in the chat room. This is a core chat application that uses web sockets.</p>
<p>The unique thing about this app will be that, we don&rsquo;t have to write a javascript client. It will all be handled by some HTMX magic. The web socket in the backend will definitely handle using Django channels.</p>
<p>Demo:</p>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Demonstration of the Chat App"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-app-demo.webm"
    ></figure>
</p>
<p><a href="https://github.com/Mr-Destructive/django-htmx-chat"  target="_blank">GitHub Repository</a></p>

<h3 class="relative group">Requirements:
    <div id="requirements" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#requirements" aria-label="Anchor">#</a>
    </span>
    
</h3>
<ul>
<li>
<p>Django</p>
</li>
<li>
<p>Django-channels</p>
</li>
<li>
<p>daphne</p>
</li>
<li>
<p>HTMX</p>
</li>
<li>
<p>SQLite or any relational database</p>
</li>
</ul>
<p>Also if we want to use the application on a large and production scale:</p>
<ul>
<li>
<p>Redis</p>
</li>
<li>
<p>channels_redis</p>
</li>
</ul>
<p>The code for this chat app is provided in the <a href="https://github.com/Mr-Destructive/django-htmx-chat"  target="_blank">GitHub repository</a>.</p>

<h2 class="relative group">Setup for Django project
    <div id="setup-for-django-project" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#setup-for-django-project" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>We will create a simple Django project to start with. The project can have two apps, one for auth and the other for the chat. You can customize the way you want your existing project accordingly. This project is just a demonstration of the use of the chat application with websockets and Django channels.</p>
<p>I&rsquo;ll call the project <code>backchat</code>, you can call it whatever you want. We will create a virtual environment and install Django in that virtual environment</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>virtualenv .venv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>For Linux/macOS:
</span></span><span style="display:flex;"><span>source .venv/bin/activate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>For Windows:
</span></span><span style="display:flex;"><span>.venv<span style="color:#ae81ff">\s</span>criptsctivate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pip install django
</span></span><span style="display:flex;"><span>django-admin startproject backchat
</span></span><span style="display:flex;"><span>cd backchat</span></span></code></pre></div></div>
<p>This will set up a base Django project. We can now work on the actual implementation of the Django project. Firstly, we will start with authentication.</p>

<h2 class="relative group">Adding basic Authentication and Authorization
    <div id="adding-basic-authentication-and-authorization" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#adding-basic-authentication-and-authorization" aria-label="Anchor">#</a>
    </span>
    
</h2>

<h3 class="relative group">Creating the accounts app
    <div id="creating-the-accounts-app" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#creating-the-accounts-app" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We can separate the authentication of the user from the rest of the project, by creating a separate app called <code>user</code> or <code>accounts</code> app.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python manage.py startapp accounts</span></span></code></pre></div></div>

<h3 class="relative group">Creating a base user model
    <div id="creating-a-base-user-model" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#creating-a-base-user-model" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We&rsquo;ll start by inheriting the <a href="https://docs.djangoproject.com/en/4.1/topics/auth/customizing/#using-a-custom-user-model-when-starting-a-project"  target="_blank">AbstractUser</a> the model provided in the <code>django.contrib.auth.models</code> module. The model has base fields like <code>username</code> and <code>password</code> which are required fields, and <code>email</code>, <code>first_name</code>, <code>last_name</code>, etc. which are not mandatory. It is better to create a custom model by inheriting the <code>AbstractUser</code> because if in the longer run, we need to make custom fields in the user model, it becomes a breeze.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># accounts/models.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> djnago.contrib.auth.models <span style="color:#f92672">import</span> AbstractUser
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>(AbstractUser):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span></span></span></code></pre></div></div>
<p>This creates a basic custom user rather than using the Django built-in user. Next, we need to make sure, Django understands the default user is the one we defined in the <code>accounts</code> app and not the default <code>User</code>. So, we just need to add a field called <code>AUTH_USER_MODEL</code> in the <code>settings.py</code> file. The value of this field will be the app name or the module name and the model in that python module that we need our custom user model to be set as the default user model.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># backchat/settings.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>INSALLED_APPS <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;accounts&#34;</span>,
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Append to the end of file</span>
</span></span><span style="display:flex;"><span>AUTH_USER_MODEL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;accounts.User&#39;</span></span></span></code></pre></div></div>

<h3 class="relative group">Initial migrations for the Django project
    <div id="initial-migrations-for-the-django-project" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#initial-migrations-for-the-django-project" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Now, this will get picked up as the default user model while referring to any processing related to the user. We can move into migrating the changes for the basic Django project and the user model.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python manage.py makemigrations
</span></span><span style="display:flex;"><span>python manage.py migrate</span></span></code></pre></div></div>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="initial migration for base django and user model"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-accounts-migrations.png"
    ></figure>
</p>

<h3 class="relative group">Creating register view
    <div id="creating-register-view" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#creating-register-view" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Further, we can add the views like register and profile for the accounts app that can be used for the basic authentication. The Login and Logout views are provided in the <code>django.contrib.auth.views</code> module, we only have to write our own register view. I will be using function-based views to keep it simple to understand but it can simply be a class-based view as well.</p>
<p>To define a view first, we need to have form, a user registration form. The form will inherit from the <a href="https://docs.djangoproject.com/en/4.1/topics/auth/default/#django.contrib.auth.forms.UserCreationForm"  target="_blank">UserCreationForm</a> form which will make the bulk of the task for us at the user registration. We can simply then override the Meta class with the fields that we want to display, so hence we just keep the <code>username</code> and the <code>password</code> fields. The form can be customized by adding in the widget attribute and specifying the classes used in them.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># accounts/forms.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> accounts.models <span style="color:#f92672">import</span> User
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.contrib.auth.forms <span style="color:#f92672">import</span> UserCreationForm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserRegisterForm</span>(UserCreationForm):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Meta</span>:
</span></span><span style="display:flex;"><span>        model<span style="color:#f92672">=</span> User
</span></span><span style="display:flex;"><span>        fields <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;username&#39;</span>, <span style="color:#e6db74">&#39;password1&#39;</span>, <span style="color:#e6db74">&#39;password2&#39;</span>]</span></span></code></pre></div></div>
<p>This will give us the <code>UserRegisterForm</code> form that can be used for displaying in the register view that we will create in the next step.</p>
<p>We will have to create the register view that will render the form for user registration and will also process the form submission.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># accounts/views.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.contrib <span style="color:#f92672">import</span> messages
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.shortcuts <span style="color:#f92672">import</span> redirect, render
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> accounts.forms <span style="color:#f92672">import</span> UserRegisterForm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">register</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;POST&#34;</span>:
</span></span><span style="display:flex;"><span>        form <span style="color:#f92672">=</span> UserRegisterForm(request<span style="color:#f92672">.</span>POST)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> form<span style="color:#f92672">.</span>is_valid():
</span></span><span style="display:flex;"><span>            form<span style="color:#f92672">.</span>save()
</span></span><span style="display:flex;"><span>            username <span style="color:#f92672">=</span> form<span style="color:#f92672">.</span>cleaned_data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;username&#34;</span>)
</span></span><span style="display:flex;"><span>            messages<span style="color:#f92672">.</span>success(
</span></span><span style="display:flex;"><span>                request, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Your account has been created! You are now able to log in&#34;</span>
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> redirect(<span style="color:#e6db74">&#34;login&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        form <span style="color:#f92672">=</span> UserRegisterForm()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> render(request, <span style="color:#e6db74">&#34;accounts/register.html&#34;</span>, {<span style="color:#e6db74">&#34;form&#34;</span>: form})</span></span></code></pre></div></div>
<p>The above register view has two cases, one for the user requesting the registration form and the second request when the user submits the form. So, when the user makes a get request, we load an empty form <code>UserRegisterForm</code> and render the <code>register</code> template with the form. We will make the templates later.</p>
<p>So, the template is just rendered when the user wants to register and when the user submits the form(sends a post request) we get the details from the post request and make it an instance of <code>UserRegisterForm</code> and save the form if it is valid. We then redirect the user to the login view (will use the default one in the next section). We parse the message as the indication that the user was created.</p>

<h3 class="relative group">Adding URLs for Authentication and Authorization
    <div id="adding-urls-for-authentication-and-authorization" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#adding-urls-for-authentication-and-authorization" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Once, we have the register view setup, we can also add login and logout views in the app. But, we don&rsquo;t have to write it ourselves, we can override them if needed, but we&rsquo;ll keep the default ones. We will use the <a href="https://docs.djangoproject.com/en/4.1/topics/auth/default/#django.contrib.auth.views.LoginView"  target="_blank">LoginView</a> and the <a href="https://docs.djangoproject.com/en/4.1/topics/auth/default/#django.contrib.auth.views.LogoutView"  target="_blank">LogoutView</a> view which are class-based views provided in the <code>django.contrib.auth.views</code> module. We will provide the respective templates for each of these views.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># accounts/urls.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.urls <span style="color:#f92672">import</span> path
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.contrib.auth <span style="color:#f92672">import</span> views <span style="color:#66d9ef">as</span> auth_views
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> user.views <span style="color:#66d9ef">as</span> user_views
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>urlpatterns <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#34;register/&#34;</span>, user_views<span style="color:#f92672">.</span>register, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;register&#34;</span>),
</span></span><span style="display:flex;"><span>    path(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;login/&#34;</span>,
</span></span><span style="display:flex;"><span>        auth_views<span style="color:#f92672">.</span>LoginView<span style="color:#f92672">.</span>as_view(template_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;accounts/login.html&#34;</span>),
</span></span><span style="display:flex;"><span>        name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;login&#34;</span>,
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    path(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logout/&#34;</span>,
</span></span><span style="display:flex;"><span>        auth_views<span style="color:#f92672">.</span>LogoutView<span style="color:#f92672">.</span>as_view(template_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;accounts/logout.html&#34;</span>),
</span></span><span style="display:flex;"><span>        name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;logout&#34;</span>,
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>]</span></span></code></pre></div></div>
<p>We have named the URLs as <code>register</code>, <code>login</code>, and <code>logout</code> so that we can use them while rendering the links for them in the templates. Now, we also need to include the URLs from the accounts app in the project URLs. We can do that by using the <code>include</code> method and specifying the app name with the module where the urlpatterns are located.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># backchat/urls.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.contrib <span style="color:#f92672">import</span> admin
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.urls <span style="color:#f92672">import</span> include, path
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>urlpatterns <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#34;admin/&#34;</span>, admin<span style="color:#f92672">.</span>site<span style="color:#f92672">.</span>urls),
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#34;auth/&#34;</span>, include(<span style="color:#e6db74">&#34;accounts.urls&#34;</span>)),
</span></span><span style="display:flex;"><span>]</span></span></code></pre></div></div>
<p>So, we have routed the <code>/auth</code> path to include all the URLs in the accounts app. So, the login view will be at the URL <code>/auth/login/</code> , and so on.</p>
<p>Also, we need to add the <code>LOGIN_REDIRECT_URL</code> and <code>LOGIN_URL</code> for specifying the url name which will be redirected once the user is logged in and the default login url name respectively.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># backchat / settings.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LOGIN_REDIRECT_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;index&#34;</span>
</span></span><span style="display:flex;"><span>LOGIN_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;login&#34;</span></span></span></code></pre></div></div>
<p>We are now almost done with the view and routing part of the accounts app and can move into the creation of templates.</p>

<h3 class="relative group">Adding Templates for authentication views
    <div id="adding-templates-for-authentication-views" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#adding-templates-for-authentication-views" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We need a few templates that we have been referencing in the views and the URLs of the accounts app in the project. So there are a couple of ways to use templates in a Django project. I prefer to have a single templates folder in the root of the project and have subfolders as the app which will have the templates specific to those apps.</p>
<p>I usually create a <code>base.html</code> file in the templates folder and use that for inheriting other templates. So, we will have to change one setting in the project to make sure it looks at <code>templates/</code> from the root of the project.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># backchat/settings.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>import os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TEMPLATES <span style="color:#f92672">=</span> <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;BACKEND&#34;</span>: <span style="color:#e6db74">&#34;django.template.backends.django.DjangoTemplates&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;DIRS&#34;</span>: <span style="color:#f92672">[</span> os.path.join<span style="color:#f92672">(</span>BASE_DIR, <span style="color:#e6db74">&#34;templates&#34;</span><span style="color:#f92672">)</span>, <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;APP_DIRS&#34;</span>: True,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;OPTIONS&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;context_processors&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;django.template.context_processors.debug&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;django.template.context_processors.request&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;django.contrib.auth.context_processors.auth&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;django.contrib.messages.context_processors.messages&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span></span></span></code></pre></div></div>
<p>Then create the folder in the same path as you see your <code>manage.py</code> file.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir templates</span></span></code></pre></div></div>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Template Set Up"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-mkdir-templates.png"
    ></figure>
</p>

<h4 class="relative group">Creating the base template
    <div id="creating-the-base-template" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#creating-the-base-template" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>The below will be the base template used for the chat application, you can custmize it as per your needs.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">title</span>&gt;Chat App&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>        {% load static %}
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://unpkg.com/htmx.org@1.8.5&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>        {% if user.is_authenticated %}
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;logout&#39; %}&#34;</span>&gt;Logout&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>        {% else %}
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;login&#39; %}&#34;</span>&gt;Login&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>        {% endif %}
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">h1</span>&gt;Back Chat&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>        {% block base %}
</span></span><span style="display:flex;"><span>        {% endblock %}
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;</span></span></code></pre></div></div>
<p>We have included the <a href="https://htmx.org/docs/#installing"  target="_blank">htmx</a> package as the script into this template as we will be using it in the actual part of chat application.</p>

<h4 class="relative group">Creating the Register Template
    <div id="creating-the-register-template" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#creating-the-register-template" aria-label="Anchor">#</a>
    </span>
    
</h4>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span># templates / accounts / register.html
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{% extends &#39;base.html&#39; %}
</span></span><span style="display:flex;"><span>{% block base %}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;content-section&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            {% csrf_token %}
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">fieldset</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form-group&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">legend</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;border-bottom mb-4&#34;</span>&gt;Register Now&lt;/<span style="color:#f92672">legend</span>&gt;
</span></span><span style="display:flex;"><span>                {{ form.as_p }}
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">fieldset</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form-group&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;btn btn-outline-info&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;Sign Up&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;border-top pt-3&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">small</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-muted&#34;</span>&gt;
</span></span><span style="display:flex;"><span>		    Already Have An Account? &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ml-2&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;login&#39; %}&#34;</span>&gt;Log In&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">small</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>{% endblock %}</span></span></code></pre></div></div>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="User Registration Page"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-register-page.png"
    ></figure>
</p>

<h4 class="relative group">Creating the Login Template
    <div id="creating-the-login-template" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#creating-the-login-template" aria-label="Anchor">#</a>
    </span>
    
</h4>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span># templates / accounts / login.html    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{% extends &#39;base.html&#39; %}
</span></span><span style="display:flex;"><span>{% block base %}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;content-section&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;login&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span> &gt;
</span></span><span style="display:flex;"><span>            {% csrf_token %}
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">fieldset</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form-group&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">legend</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;border-bottom mb-4&#34;</span>&gt;LOG IN&lt;/<span style="color:#f92672">legend</span>&gt;
</span></span><span style="display:flex;"><span>                {{ form.as_p }}
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">fieldset</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form-group&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;btn btn-outline-info&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;Log In&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;border-top pt-3&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">small</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-muted&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                Register Here &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ml-2&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;register&#39; %}&#34;</span>&gt;Sign Up&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">small</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>{% endblock %}</span></span></code></pre></div></div>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="User Login Page"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-login-page.png"
    ></figure>
</p>
<p>Creating the Logout Template</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span># templates / accounts / logout.html    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{% extends &#39;base.html&#39; %}
</span></span><span style="display:flex;"><span>{% block base %}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h2</span>&gt;You have been logged out&lt;/<span style="color:#f92672">h2</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;border-top pt-3&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">small</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-muted&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;login&#39; %}&#34;</span>&gt;Log In Again&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">small</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>{% endblock %}</span></span></code></pre></div></div>

<h2 class="relative group">Install and setup channels
    <div id="install-and-setup-channels" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#install-and-setup-channels" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>We will be using channels to create long-running connections, it is a wrapper around Django&rsquo;s asynchronous components and allows us to incorporate other protocols like web sockets and other asynchronous protocols.</p>
<p>So, we will be using the Django channels package that will allow us to use the WebSocket protocol in the chat application. <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API"  target="_blank">WebSocket</a> is a communication protocol(set of rules and standards to be followed) that allows both the client and server to send and receive messages(communication).</p>
<p>To install Django channels, we can use pip and install channels with daphne which will be used as the web server gateway interface for asynchronous web applications.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install -U channels<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;daphne&#34;</span><span style="color:#f92672">]</span></span></span></code></pre></div></div>
<p>So this will install the latest version of channels and daphne. We now have <a href="https://channels.readthedocs.io/en/stable/installation.html"  target="_blank">channels</a> in our Django project, we simply need to configure the <code>CHANNEL_LAYER</code> config for specifying the backend used that can be <code>Redis</code>, <code>In-Memory</code>, or others. We need to add <code>channels</code> , <code>daphne</code> to the <code>INSALLED_APPS</code> config of the project. Make sure the <code>daphne</code> app is on top of the applications list.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># backchat/settings.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>INSALLED_APPS <span style="color:#f92672">=</span> <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;daphne&#34;</span>,
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;channels&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ASGI_APPLICATION <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;backchat.asgi.application&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For InMemory channels</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CHANNEL_LAYERS <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;default&#39;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;BACKEND&#34;</span>: <span style="color:#e6db74">&#34;channels.layers.InMemoryChannelLayer&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For Redis</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CHANNEL_LAYERS <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;default&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;BACKEND&#34;</span>: <span style="color:#e6db74">&#34;asgi_redis.RedisChannelLayer&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;CONFIG&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;hosts&#34;</span>: <span style="color:#f92672">[(</span><span style="color:#e6db74">&#34;redis-host-url&#34;</span>, 6379<span style="color:#f92672">)]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></div>

<h3 class="relative group">Redis Configuration (Optional)
    <div id="redis-configuration-optional" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#redis-configuration-optional" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>You can either use the <a href="https://channels.readthedocs.io/en/latest/topics/channel_layers.html"  target="_blank">InMemoryChannelLayer</a> or you can use them <code>RedisChannelLayer</code> for the backend of the chat app. There are other types of backends like <code>Amazon SQS</code> services, <code>RabbitMQ</code>, <code>Kafka</code>, <code>Google Cloud Pub/Sub</code>, etc. I will be creating the app with only the <code>InMemoryChannelLayer</code> but will provide a guide for redis as well, both are quite similar and only have a few nuances.</p>
<p>We need to install <a href="https://github.com/django/channels_redis/"  target="_blank">channels_redis</a> it for integrating redis in the Django project with channels.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install channels_redis</span></span></code></pre></div></div>
<p>So, this will make the <code>channels_redis</code> package available in the project, we use this package for real-time storage, in the case of the chat app, we might use it for storing messages or room details, etc.</p>

<h2 class="relative group">Creating the Chat App
    <div id="creating-the-chat-app" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#creating-the-chat-app" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Further, we now can create another app for handling the rooms and chat application logic. This app will have its own models, views, and URLs. Also, we will define consumers and routers just like views and URLs but for asynchronous connections. More on that soon.</p>
<p>So, let&rsquo;s create the <code>chat</code> app.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python manage.py startapp chat</span></span></code></pre></div></div>
<p>Then we will add the chat app to the <code>INSALLED_APPS</code> config.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># backchat/settings.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>INSALLED_APPS <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;chat&#34;</span>,
</span></span><span style="display:flex;"><span>]</span></span></code></pre></div></div>
<p>So, this will make sure to load the chat app in the project. Whenever we run any commands like migrations or running the server, it keeps the app in the <code>INSALLED_APPS</code> checked up.</p>

<h3 class="relative group">Defining models
    <div id="defining-models" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#defining-models" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>This is optional, but we&rsquo;ll do it for since we are making a Django app. We already have an auth system configured, adding rooms and authorizing the users will become easier then.</p>
<p>So, let&rsquo;s create the models for the chat app which will be the <code>Room</code>.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># chat/models.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.db <span style="color:#f92672">import</span> models
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> accounts.models <span style="color:#f92672">import</span> User
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Room</span>(models<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">128</span>)
</span></span><span style="display:flex;"><span>    slug <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>SlugField(unique<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    users <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ManyToManyField(User)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__str__</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Message</span>(models<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>    room <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(Room, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>CASCADE)
</span></span><span style="display:flex;"><span>    user <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(User, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>CASCADE)
</span></span><span style="display:flex;"><span>    message <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>TextField()
</span></span><span style="display:flex;"><span>    created_at <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>DateTimeField(auto_now_add<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__str__</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>room<span style="color:#f92672">.</span>name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; - &#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            str(self<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>username) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; : &#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            str(self<span style="color:#f92672">.</span>message)
</span></span><span style="display:flex;"><span>        )</span></span></code></pre></div></div>
<p>So, we simply have the name which will be taken from the user, and the slug which will be served as the URL to the room. The users are set as <a href="https://docs.djangoproject.com/en/4.1/ref/models/fields/#django.db.models.ManyToManyField"  target="_blank">ManyToManyField</a> since one room can have multiple users and a user can be in multiple rooms. Also we are creating the model <code>Message</code> that will be storing the room and the user as the foreign key and the actual text as the message, we can improve the security by encrypting the text but it&rsquo;s not the point of this article.</p>
<p>We have set the <code>created_at</code> the field which will set the time when the object was created. Finally, the dunder string method is used for representing the message object as a price of the concatenation of strings of room name, username, and the message. This is useful for admin stuff as it makes it easier to read the object rather than the default id.</p>
<p>Now, once the models are designed we can migrate the models into the database.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>python manage.py makemigrations
</span></span><span style="display:flex;"><span>python manage.py migrate</span></span></code></pre></div></div>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Chat app migrations"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-migrations.png"
    ></figure>
</p>
<p>We now have a decent model structure for the chat application. We can now start the crux of the application i.e. consumers and routing with channels.</p>

<h3 class="relative group">Writing consumers and routers for WebSockets
    <div id="writing-consumers-and-routers-for-websockets" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#writing-consumers-and-routers-for-websockets" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>So, we start with the bare bones provided in the tutorial on the channel <a href="https://channels.readthedocs.io/en/stable/tutorial/part_3.html"  target="_blank">documentation</a>. We create a class (consumer) called <code>ChatConsumer</code> which inherits from the <code>AsyncWebsocketConsumer</code> provided by the <code>channels.generic.websocket</code> module. This has a few methods like <code>connect</code>, <code>disconnect</code>, and <code>receive</code>. These are the building blocks of a consumer. We define these methods as they will be used for communication via the WebSocket protocol through the channels interface.</p>
<p>In the following block of code, we are essentially doing the following:</p>
<ul>
<li>
<p>Accepting connection on the requested room name</p>
</li>
<li>
<p>Sending and Receiving messages on the room/group</p>
</li>
<li>
<p>Closing the WebSocket connection and removing the client from the room/group</p>
</li>
</ul>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># chat/consumers.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> asgiref.sync <span style="color:#f92672">import</span> sync_to_async
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> channels.generic.websocket <span style="color:#f92672">import</span> AsyncWebsocketConsumer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> chat.models <span style="color:#f92672">import</span> Room, Message
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChatConsumer</span>(AsyncWebsocketConsumer):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">connect</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>room_name <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>scope[<span style="color:#e6db74">&#34;url_route&#34;</span>][<span style="color:#e6db74">&#34;kwargs&#34;</span>][<span style="color:#e6db74">&#34;room_slug&#34;</span>]
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>room_group_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;chat_</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>room_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>user <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>scope[<span style="color:#e6db74">&#34;user&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>channel_layer<span style="color:#f92672">.</span>group_add(
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>room_group_name, self<span style="color:#f92672">.</span>channel_name
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>accept()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">disconnect</span>(self, close_code):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>channel_layer<span style="color:#f92672">.</span>group_discard(
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>room_group_name, self<span style="color:#f92672">.</span>channel_name
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">receive</span>(self, text_data):
</span></span><span style="display:flex;"><span>        text_data_json <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(text_data)
</span></span><span style="display:flex;"><span>        message <span style="color:#f92672">=</span> text_data_json[<span style="color:#e6db74">&#34;message&#34;</span>]
</span></span><span style="display:flex;"><span>        username <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>username
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>channel_layer<span style="color:#f92672">.</span>group_send(
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>room_group_name, 
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;chat_message&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;message&#34;</span>: message,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;username&#34;</span>: username,
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chat_message</span>(self, event):
</span></span><span style="display:flex;"><span>        message <span style="color:#f92672">=</span> event[<span style="color:#e6db74">&#34;message&#34;</span>]
</span></span><span style="display:flex;"><span>        username <span style="color:#f92672">=</span> event[<span style="color:#e6db74">&#34;username&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>send(
</span></span><span style="display:flex;"><span>            text_data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;message&#34;</span>: message,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;username&#34;</span>: username
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        )</span></span></code></pre></div></div>

<h4 class="relative group">Accept the WebSocket connection
    <div id="accept-the-websocket-connection" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#accept-the-websocket-connection" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>Here, room and group more or less mean the same thing but are different in different contexts. For instance, the group refers to the collection of clients which are connected to a channel(communication between consumer and web socket) and the Room is referring to the collection of clients connected to a single connection stream like a literal room. So we can say, the group is a technical term and the room is more of a layman&rsquo;s term for the same thing.</p>
<p>The method <code>connect</code> is called when the client establishes a websocket connection. When that happens, the function gets the room slug from the URL of the client and stores <code>room_name</code> which is a string. It creates a separate variable called <code>room_group_name</code> by prepending the <code>chat_</code> string to the <code>room_name</code>, it also gets the currently logged-in user from the request. It then adds the <code>channel_name</code> to the group named <code>room_group_name</code>. The <code>channel_name</code> is a unique identifier to the connection/consumer in the channel. By adding the <code>channel_name</code>, the consumer then can broadcast the message to all the channels within the group. Finally, the function accepts the connection, and a <strong>webcoket connection is established from both ends, connection is sent from the client and is now accepted from the backend.</strong></p>

<h4 class="relative group">Disconnect from the WebSocket connection
    <div id="disconnect-from-the-websocket-connection" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#disconnect-from-the-websocket-connection" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>When the client sends a close connection request to the server, the <code>disconnect</code> method is triggered and it basically removes the <code>channel_name</code> from the group i.e. the group name <code>room_group_name</code> whatever the string it happens to be. So, it basically removes the client from the broadcast group and hence it can&rsquo;t receive or send messages through the websocket since it has been closed from both ends.</p>
<p>If you would have paid attention to the <code>close_code</code> in-method parameter, it is not being used currently. However, we can use it for checking why the connection was closed, as the <code>close_code</code> is a numeric value just like the status code in the web request for letting the server know the reason for disconnecting from the client.</p>

<h4 class="relative group">Receive a message from the WebSocket connection
    <div id="receive-a-message-from-the-websocket-connection" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#receive-a-message-from-the-websocket-connection" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>The <code>recieve</code> method is the core of the consumer as it is responsible for all the logic and parsing of the message and broadcasting of the messages from the clients to the group channels. The function takes in a parameter called <code>text_data</code> and it is sent from the client through websocket, so it is JSON content. We need to get the actual message from the JSON object or any other piece of content from the client. So, we deserialize (convert the JSON object to python objects) the received payload, and get the value from the key <code>message</code>. The key is the input name or id from the client sending the request through the web socket, so it can be different depending on the frontend template(we&rsquo;ll see the front end soon as well).</p>
<p>We get the user from the scope of the consumer as we previously initialized it in the connect method. This can be used for understanding which user has sent the message, it will be used later on as we send/broadcast the message to the group.</p>
<p>Now, the final piece in the receive method is the <code>channel_layer.group_send</code> method, this method as the name suggests is used to send or broadcast the received message to the entire group. The method has two parameters:</p>
<ol>
<li>
<p>The name of the group</p>
</li>
<li>
<p>The JSON body containing the message and other details</p>
</li>
</ol>
<p>The method is not directly sending the message but it has a type key in the JSON body which will be the function name to call. The function will simply call the other funciton mentioned in the type key in the dict. The following keys in the dict will be the parameters of that funciton. In this case, the funciton specified in the <code>type</code> key is <code>chat_message</code> which takes in the <code>event</code> as the parameter. This event will have all the parameters from the <code>group_send</code> method.</p>
<p>So, the <code>chat_message</code> will load in this message, username, and the room name and then call the <code>send</code> method which actually sends the message as a JSON payload to the WebSocket connection which will be received by all the clients in the same group as provided in the <code>room_group_name</code> string.</p>

<h3 class="relative group">Adding Routers for WebSocket connections
    <div id="adding-routers-for-websocket-connections" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#adding-routers-for-websocket-connections" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>So, till this point have consumers, which are just like views in terms of channels. Now, we need some URL routes to map these consumers to a path. So, we will create a file/module called <code>routing.py</code> which will look quite similar to the <code>urls.py</code> file. It will have a list called <code>websocket_urlpatterns</code> just like <code>urlpatterns</code> with the list of <code>path</code>. These paths however are not <code>http</code> routes but will serve for the <code>WebSocket</code> path.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># chat / routing.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.urls <span style="color:#f92672">import</span> path
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> chat <span style="color:#f92672">import</span> consumers
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>websocket_urlpatterns <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#39;chat/&lt;str:room_slug&gt;/&#39;</span>, consumers<span style="color:#f92672">.</span>ChatConsumer<span style="color:#f92672">.</span>as_asgi()),
</span></span><span style="display:flex;"><span>]</span></span></code></pre></div></div>
<p>In the above code block, we have defined a URL for the web socket with the path as <code>/chat/&lt;room_slug&gt;</code> where room_name will be the <code>slug</code> for the room. The path is bound with the consumer-defined in the <code>consumers.py</code> module as <code>ChatConsumer</code>. The <code>as_asgi</code> method is used for converting a view into an ASGI-compatible view for the WebSocket interface.</p>

<h3 class="relative group">Setting up ASGI Application
    <div id="setting-up-asgi-application" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#setting-up-asgi-application" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We are using the ASGI application config rather than a typical WSGI application which only works one request at a time. We want the chat application to be asynchronous because multiple clients might send and receive the messages at the same time, we don&rsquo;t want to make a client wait before the server process a message from another client, that&rsquo;s just the reason we are using WebSocket protocol.</p>
<p>So, we need to also make sure, it makes the http request and also add our websocket config from the chat app we created in the previous sections. So, inside the <code>asgi.py</code> file in the project config module, we need to make some changes to include the chat application configurations.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># backchat / asgi.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.core.asgi <span style="color:#f92672">import</span> get_asgi_application
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> channels.auth <span style="color:#f92672">import</span> AuthMiddlewareStack
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> channels.routing <span style="color:#f92672">import</span> ProtocolTypeRouter, URLRouter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>setdefault(<span style="color:#e6db74">&#39;DJANGO_SETTINGS_MODULE&#39;</span>, <span style="color:#e6db74">&#39;backchat.settings&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> chat <span style="color:#f92672">import</span> routing
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>application <span style="color:#f92672">=</span> ProtocolTypeRouter({
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;http&#39;</span>: get_asgi_application(),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;websocket&#34;</span>:AuthMiddlewareStack(
</span></span><span style="display:flex;"><span>        URLRouter(
</span></span><span style="display:flex;"><span>            routing<span style="color:#f92672">.</span>websocket_urlpatterns
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>})</span></span></code></pre></div></div>
<p>We will override the <code>application</code> config which is a component used for routing different types of protocols for the <code>ASGI</code> application. We have set the two keys, <code>http</code> and <code>websocket</code> in our application. The <code>http</code> type of requests will be served with the <code>get_asgi_application</code> application which is used for running the application in an ASGI environment.</p>
<p>For <code>websocket</code> type of requests, we are setting the <a href="https://channels.readthedocs.io/en/latest/topics/authentication.html"  target="_blank">AuthMiddlewareStack</a> which helps in authenticating the users requesting the WebSocket connection and allows only authorized users to make a connection to the application. The <a href="https://channels.readthedocs.io/en/stable/topics/routing.html"  target="_blank">URLRouter</a> is used for mapping the list of URL patterns with the incoming request. So, this basically serves the request URL with the appropriate consumer in the application. We are parsing in the <code>websocket_urlpatterns</code> as the list of URLs that will be used for the WebSocket connections.</p>
<p>Now, we run the server, we should be seeing the <code>ASGI</code> server serving our application rather than the plain WSGI application.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>$ python manage.py runserver
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Watching for file changes with StatReloader
</span></span><span style="display:flex;"><span>Performing system checks...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System check identified no issues (0 silenced).
</span></span><span style="display:flex;"><span>February 05, 2023 - 09:22:45
</span></span><span style="display:flex;"><span>Django version 4.1.5, using settings &#39;backchat.settings&#39;
</span></span><span style="display:flex;"><span>Starting ASGI/Daphne version 4.0.0 development server at http://127.0.0.1:8000/
</span></span><span style="display:flex;"><span>Quit the server with CONTROL-C.</span></span></code></pre></div></div>
<p>The application is not complete yet, it might not have most components working functional yet. So, we&rsquo;ll now get into making the user interfaces for the application, to create, join, and view rooms in the application.</p>

<h3 class="relative group">Adding Views for Chat Rooms
    <div id="adding-views-for-chat-rooms" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#adding-views-for-chat-rooms" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We will have a couple of views like create room page, the join room page, and the chat room page. We will define each view as a distinct view and all of them will require authenticated users.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># chat / views.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.contrib.auth.decorators <span style="color:#f92672">import</span> login_required
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.shortcuts <span style="color:#f92672">import</span> render, reverse, redirect
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.utils.text <span style="color:#f92672">import</span> slugify
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> chat.models <span style="color:#f92672">import</span> Room
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@login_required</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">index</span>(request, slug):
</span></span><span style="display:flex;"><span>    room <span style="color:#f92672">=</span> Room<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>get(slug<span style="color:#f92672">=</span>slug)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> render(request, <span style="color:#e6db74">&#39;chat/room.html&#39;</span>, {<span style="color:#e6db74">&#39;name&#39;</span>: room<span style="color:#f92672">.</span>name, <span style="color:#e6db74">&#39;slug&#39;</span>: room<span style="color:#f92672">.</span>slug})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@login_required</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">room_create</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;POST&#34;</span>:
</span></span><span style="display:flex;"><span>        room_name <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>POST[<span style="color:#e6db74">&#34;room_name&#34;</span>]
</span></span><span style="display:flex;"><span>        uid <span style="color:#f92672">=</span> str(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(random<span style="color:#f92672">.</span>choices(string<span style="color:#f92672">.</span>ascii_letters <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits, k<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)))
</span></span><span style="display:flex;"><span>        room_slug <span style="color:#f92672">=</span> slugify(room_name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> uid)
</span></span><span style="display:flex;"><span>        room <span style="color:#f92672">=</span> Room<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>create(name<span style="color:#f92672">=</span>room_name, slug<span style="color:#f92672">=</span>room_slug)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redirect(reverse(<span style="color:#e6db74">&#39;chat&#39;</span>, kwargs<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;slug&#39;</span>: room<span style="color:#f92672">.</span>slug}))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> render(request, <span style="color:#e6db74">&#39;chat/create.html&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@login_required</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">room_join</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;POST&#34;</span>:
</span></span><span style="display:flex;"><span>        room_slug <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>POST[<span style="color:#e6db74">&#34;room_slug&#34;</span>]
</span></span><span style="display:flex;"><span>        room <span style="color:#f92672">=</span> Room<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>get(slug<span style="color:#f92672">=</span>room_slug)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redirect(reverse(<span style="color:#e6db74">&#39;chat&#39;</span>, kwargs<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;slug&#39;</span>: room<span style="color:#f92672">.</span>slug}))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> render(request, <span style="color:#e6db74">&#39;chat/join.html&#39;</span>)</span></span></code></pre></div></div>
<p>In the above views module, we have added 3 views namely <code>index</code> as the room page, <code>room_create</code> for the room creation page, and the <code>room_join</code> for the room join page. The index view is a simple get request to the provided slug of the room, it gets the slug from the URL from the request and fetches an object of the room associated with that slug. Then it renders the room template with the context variables like the name of the room and the slug associated with that room.</p>
<p>The <code>room_create</code> view is a simple two-case view that either can render the room creation page or process the submitted form and create the room. Just like we used in the <code>register</code> view in the accounts app. When the user will send a <code>GET</code> request to the URL which we will map to <code>/create/</code> shortly after this, the user will be given a form. So, we will render the <code>create.html</code> template. We will create the html template shortly.<br>
If the user has sent a <code>POST</code> request to the view via the <code>/create</code> URL, we will fetch the name field in the sent request and create a unique identifier with the name of the room. We will slugify the concatenation of the name with the uid and will set it as the slug of the room. We will then simply create the room and redirect the user to the <code>room</code> page.</p>
<p>The <code>room_join</code> view also is a two-case view, where the user can either request the join room form or send a slug with the form submission. If the user is requesting a form, we will render the <code>join.html</code> template. If the user is submitting the form, we will fetch the room based on the slug provided and redirect the user to the <code>room</code> page.</p>
<p>So, the <code>room_join</code> and <code>room_create</code> views are quite similar, we are fetching an already existing room in the case of the join view and creating a new instance of room in the create view. Now, we will connect the views to the URLs and finally get to the templates.</p>

<h3 class="relative group">Connecting Views and URLs
    <div id="connecting-views-and-urls" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#connecting-views-and-urls" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We have three views to route to a URL. But we will also have one additional URL which will be the home page for the application, on that page the user can choose to either join or create a room. We have the room creation, join the room and the room view to be mapped in this URL routing of the app.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># chat / urls.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.urls <span style="color:#f92672">import</span> path
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.views.generic <span style="color:#f92672">import</span> TemplateView
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> chat <span style="color:#f92672">import</span> views
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>urlpatterns <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#34;&#34;</span>, TemplateView<span style="color:#f92672">.</span>as_view(template_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;base.html&#34;</span>), name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;index&#39;</span>),
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#34;room/&lt;str:slug&gt;/&#34;</span>, views<span style="color:#f92672">.</span>index, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;chat&#39;</span>),
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#34;create/&#34;</span>, views<span style="color:#f92672">.</span>room_create, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;room-create&#39;</span>),
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#34;join/&#34;</span>, views<span style="color:#f92672">.</span>room_join, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;room-join&#39;</span>),
</span></span><span style="display:flex;"><span>]</span></span></code></pre></div></div>
<p>So, the first route is the home page view called <code>index</code>, we have used the <a href="https://docs.djangoproject.com/en/4.1/ref/class-based-views/base/#templateview"  target="_blank">TemplateView</a> which will simply render the template provided. We don&rsquo;t have to create a separate view for just rendering a template. We already have defined the <code>base.html</code> template while setting up the <code>accounts</code> app. This will be the same template, we will add some more content to the template later on. The URL mapped is the <code>/</code> since we will add the URLs of this app to the project URLs with an empty <code>&quot;&quot;</code> path.</p>
<p>The second route is used for the room index page, i.e. where the user will be able to send and receive messages. The path is assigned as <code>/room/&lt;str:slug&gt;/</code> indicating a parameter called slug of type string will be used in accessing a particular room. The URL will be bound to the index view that we created in the views file, which fetches the room based on the slug, so here is where the slug will be coming from. The name of the URL-View route will be <code>chat</code> but you can keep it as per your requirements. The URL name is really handy for use in the templates.</p>
<p>The third route is for the room creation page. The <code>/create/</code> URL will be bound to the <code>room_create</code> view, as we discussed, it will serve two purposes, one to render the form for creating the room, and the other for sending a <code>POST</code> request to the same path for the creating the Room with the name provided. The name is not required but helps in identifying and making it user-friendly. The name of this URL is set as <code>room-create</code>.</p>
<p>The final route is for joining the room, the <code>/join/</code> URL will be triggering the <code>room_join</code> view. Similar to the <code>room-create</code> URL, the URL will render the join room form on a <code>GET</code> request, fetch the room with the provided slug and redirect to the room page. Here, the slug field in the form will be required for actually finding the matching room. The name of the URL route is set as <code>room-join</code>.</p>
<p>We now add the URLs from the chat app to the project URLs. This will make the <code>/</code> as the entry point for the chat application URLs.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># backchat / urls.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.contrib <span style="color:#f92672">import</span> admin
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.urls <span style="color:#f92672">import</span> path, include
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>urlpatterns <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#34;admin/&#34;</span>, admin<span style="color:#f92672">.</span>site<span style="color:#f92672">.</span>urls),
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#34;auth/&#34;</span>, include(<span style="color:#e6db74">&#39;accounts.urls&#39;</span>)),
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#34;&#34;</span>, include(<span style="color:#e6db74">&#39;chat.urls&#39;</span>)),
</span></span><span style="display:flex;"><span>]</span></span></code></pre></div></div>
<p>Hence the process is completed for the backend to process the message, it then is dependent on the client to process and render the message.</p>
<p>Till HTMX was not a thing!</p>
<p>We won&rsquo;t have to write a single line of javascript to receive and handle the WebSocket connection!</p>

<h3 class="relative group">Creating Templates and adding htmx
    <div id="creating-templates-and-adding-htmx" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#creating-templates-and-adding-htmx" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We now move into the actual frontend or creating the template for actually working with the rooms and user interaction. We will have three pieces of templates, a room creates the page, a room join page, and a room chat page. As these template names suggest, they will be used for creating a room with the name, joining the room with the slug, and the room chat page where the user will send and receive messages.</p>
<p>Let/s modify the base template first.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">title</span>&gt;Chat App&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>        {% load static %}
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://unpkg.com/htmx.org@1.8.5&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;index&#39; %}&#34;</span>&gt;Home&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>        {% if user.is_authenticated %}
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;logout&#39; %}&#34;</span>&gt;Logout&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>        {% else %}
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;login&#39; %}&#34;</span>&gt;Login&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>        {% endif %}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">body</span> <span style="color:#a6e22e">hx-ext</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ws&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">h1</span>&gt;Back Chat&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>        {% block base %}
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;room-join&#39; %}&#34;</span>&gt;Join Room&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;room-create&#39; %}&#34;</span>&gt;Create Room&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>        {% endblock %}
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;</span></span></code></pre></div></div>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Chat App Home Page"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-home-page.png"
    ></figure>
</p>

<h4 class="relative group">Create Room Template
    <div id="create-room-template" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#create-room-template" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>We will have to render the form with a field like <code>name</code> for setting it as the name of the room, it is not required but again, it makes it easier for the user to find the name of the room a bit more friendly than random characters.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span># templates / chat / create.html
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{% extends &#39;base.html&#39; %}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{% block base %}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;post&#39;</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{% url &#39;</span><span style="color:#a6e22e">room-create</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#960050;background-color:#1e0010">%}&#39;</span>&gt;
</span></span><span style="display:flex;"><span>        {% csrf_token %}
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;room_name&#39;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;room_name&#39;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Room Name&#39;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;submit&#39;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>{% endblock %}</span></span></code></pre></div></div>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Chat Room Create Page"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-create-room-page.png"
    ></figure>
</p>
<p>The template is inherited from the <code>base.html</code> template and we render a form with the <code>room_name</code> input. The form will be submitted to the URL named <code>room-create</code> hence it will send a <code>POST</code> request to the server where it will create the room and further process the request.</p>

<h4 class="relative group">Join Room Template
    <div id="join-room-template" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#join-room-template" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>The join room template is similar to the create room template except it gets the slug of the room from the user rather than the name which is not a unique one to join the room.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span># templates / chat / join.html
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{% extends &#39;base.html&#39; %}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{% block base %}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;post&#39;</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{% url &#39;</span><span style="color:#a6e22e">room-join</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#960050;background-color:#1e0010">%}&#39;</span>&gt;
</span></span><span style="display:flex;"><span>        {% csrf_token %}
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;room_slug&#39;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;room_slug&#39;</span> <span style="color:#a6e22e">required</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;true&#39;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Room Code&#39;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;submit&#39;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>{% endblock %}</span></span></code></pre></div></div>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Chat Room Join Page"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-join-room-page.png"
    ></figure>
</p>
<p>The form will be submitted to the URL named <code>room-join</code> hence it will send a <code>POST</code> request to the server where it will fetch the room and further process the request.</p>

<h3 class="relative group">Room Template (HTMX code)
    <div id="room-template-htmx-code" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#room-template-htmx-code" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Now, time for the actual ingredient in the application, some HTMX magic!</p>
<p>This template, as the two templates above inherit from the base template, that&rsquo;s the same thing. But it has a special <code>div</code> with the attribute <a href="https://htmx.org/attributes/hx-ws/"  target="_blank">hx-ws</a> which is used for using attributes related to the web socket in the htmx library. The <code>connect</code> value is used for connecting to a WebSocket. The value of the attribute must be set to the URL of the WebSocket to be connected. In our case, it is the URL path from the <code>routing</code> app as <code>/chat/&lt;room_slug&gt;/</code>. This simply will connect the client to the WebSocket from the backend. The other important attribute is the <code>send</code> which is used for sending a message to the connected web socket.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span># templates / chat / room.html
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{% extends &#39;base.html&#39; %}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{% block base %}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h2</span>&gt;{{ name }}&lt;/<span style="color:#f92672">h2</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">hx-ws</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;connect:/chat/{{ slug }}/&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">hx-ws</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;send:submit&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;message&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>     &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>     &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;messages&#39;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>{% endblock %}</span></span></code></pre></div></div>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Chat Room Page"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-room-page.png"
    ></figure>
</p>
<p>NOTE: The template has a div with the id <code>messages</code> which will be very important for sending the messages from the WebSocket to the client, so more on that when we use the HTMX part.</p>
<p>For testing this template, you can create a room, and that will redirect you to the room template as we have seen in the views for the room creation. If you see something like <code>WebSocket CONNECT</code> it means, that the application has been able to establish a WebSocket connection to the backend, and we can be ready to accept messages and other stuff.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>HTTP GET /chat/room/def_teas/ 200 [0.03, 127.0.0.1:38660]
</span></span><span style="display:flex;"><span>WebSocket HANDSHAKING /chat/def_teas/ [127.0.0.1:38666]
</span></span><span style="display:flex;"><span>WebSocket CONNECT /chat/def_teas/ [127.0.0.1:38666]</span></span></code></pre></div></div>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Django ASGI server websocket connection"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-asgi-server.png"
    ></figure>
</p>
<p>Till this point, we should have a running and almost complete application, though we just have a minor part missing that will be the most important part.</p>

<h3 class="relative group">Sending HTML response from backend for htmx
    <div id="sending-html-response-from-backend-for-htmx" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#sending-html-response-from-backend-for-htmx" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We will be sending a fragment of HTML from the backend when the user sends a message, to broadcast it to the group. Let&rsquo;s make some changes to the application, especially to the receive method in the <code>ChatConsumer</code> of the chat application.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># chat / consumers.py</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">receive</span>(self, text_data):
</span></span><span style="display:flex;"><span>        text_data_json <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(text_data)
</span></span><span style="display:flex;"><span>        message <span style="color:#f92672">=</span> text_data_json[<span style="color:#e6db74">&#34;message&#34;</span>]
</span></span><span style="display:flex;"><span>        user <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>user
</span></span><span style="display:flex;"><span>        username <span style="color:#f92672">=</span> user<span style="color:#f92672">.</span>username
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>channel_layer<span style="color:#f92672">.</span>group_send(
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>room_group_name, 
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;chat_message&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;message&#34;</span>: message,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;username&#34;</span>: username,
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chat_message</span>(self, event):
</span></span><span style="display:flex;"><span>        message <span style="color:#f92672">=</span> event[<span style="color:#e6db74">&#34;message&#34;</span>]
</span></span><span style="display:flex;"><span>        username <span style="color:#f92672">=</span> event[<span style="color:#e6db74">&#34;username&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># This is the crucial part of the application</span>
</span></span><span style="display:flex;"><span>        message_html <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&lt;div hx-swap-oob=&#39;beforeend:#messages&#39;&gt;&lt;p&gt;&lt;b&gt;</span><span style="color:#e6db74">{</span>username<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/b&gt;: </span><span style="color:#e6db74">{</span>message<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/p&gt;&lt;/div&gt;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>send(
</span></span><span style="display:flex;"><span>            text_data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;message&#34;</span>: message_html,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;username&#34;</span>: username
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        )</span></span></code></pre></div></div>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Chat Room Message"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-room-msg-1.png"
    ></figure>
<br>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Chat Room Message 2 Users"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-room-msg-2.png"
    ></figure>
<br>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Chat Room Message"
    src="https://meetgor-cdn.pages.dev/django-htmx/chat-room-msg-3.png"
    ></figure>
</p>
<p>In the above snippet, we are just changing the final message object to include some HTML just simple. The HTML however has home htmx attributes like <a href="https://htmx.org/attributes/hx-swap-oob/"  target="_blank">hx-swap-oob</a> which will just update the specified DOM element to the content in the div. In this case, the DOM element is <code>#message</code> which is the id message present in the room template. We basically add the username and the message into the same id by appending it to the element. That&rsquo;s it, it would work and it would start showing the messages from the connected clients and broadcast them as well.</p>
<p>There are some things to keep in mind while using htmx in the long run especially when the htmx 2.0 is released, it will have <code>ws</code> as a separate extension. It will have a bit of a different syntax than above. I have tried the latest version but doesn&rsquo;t seem to work. I&rsquo;ll just leave a few snippets for your understanding of the problem.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span># templates / chat / room.html
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{% extends &#39;base.html&#39; %}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{% block base %}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h2</span>&gt;{{ name }}&lt;/<span style="color:#f92672">h2</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">hx-ext</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ws&#34;</span> <span style="color:#a6e22e">ws-connect</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/chat/{{ slug }}/&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">ws-send</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;message&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;messages&#39;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>{% endblock %}</span></span></code></pre></div></div>
<p>I have added, the <code>hx-ext</code> as <code>ws</code> which is a htmx <a href="https://htmx.org/extensions/web-sockets/"  target="_blank">extension for websocket</a>. This extension has websocket-specific attributes like <code>ws-connect</code> and <code>ws-send</code>. I have tried a combination like changing the htmx versions, adding submit value as the <code>ws-send</code> attribute, etc, but no results yet. I have opened a <a href="https://github.com/bigskysoftware/htmx/discussions/1231"  target="_blank">discussion</a> on GitHub for this issue, you can express your solution or views there.</p>

<h3 class="relative group">Adding some utility features for the chat app
    <div id="adding-some-utility-features-for-the-chat-app" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#adding-some-utility-features-for-the-chat-app" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We can save messages, add and remove the users from the room according to the connection, and other stuff that can make this a fully-fledged app. So, I have made a few changes to the chat consumers for saving the messages and also updating the room with the users in the room.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># chat / consumers.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> asgiref.sync <span style="color:#f92672">import</span> sync_to_async
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> channels.generic.websocket <span style="color:#f92672">import</span> AsyncWebsocketConsumer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> chat.models <span style="color:#f92672">import</span> Room, Message
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChatConsumer</span>(AsyncWebsocketConsumer):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">connect</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>room_name <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>scope[<span style="color:#e6db74">&#34;url_route&#34;</span>][<span style="color:#e6db74">&#34;kwargs&#34;</span>][<span style="color:#e6db74">&#34;room_slug&#34;</span>]
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>room_group_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;chat_</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>room_name
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>user <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>scope[<span style="color:#e6db74">&#34;user&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>channel_layer<span style="color:#f92672">.</span>group_add(
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>room_group_name, self<span style="color:#f92672">.</span>channel_name
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Add the user when the client connects</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>add_user(self<span style="color:#f92672">.</span>room_name, self<span style="color:#f92672">.</span>user)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>accept()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">disconnect</span>(self, close_code):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Remove the user when the client disconnects</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>remove_user(self<span style="color:#f92672">.</span>room_name, self<span style="color:#f92672">.</span>user)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>channel_layer<span style="color:#f92672">.</span>group_discard(
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>room_group_name, self<span style="color:#f92672">.</span>channel_name
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">receive</span>(self, text_data):
</span></span><span style="display:flex;"><span>        text_data_json <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(text_data)
</span></span><span style="display:flex;"><span>        message <span style="color:#f92672">=</span> text_data_json[<span style="color:#e6db74">&#34;message&#34;</span>]
</span></span><span style="display:flex;"><span>        user <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>user
</span></span><span style="display:flex;"><span>        username <span style="color:#f92672">=</span> user<span style="color:#f92672">.</span>username
</span></span><span style="display:flex;"><span>        room <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>room_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Save the message on recieving</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>save_message(room, user, message)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>channel_layer<span style="color:#f92672">.</span>group_send(
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>room_group_name, 
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;chat_message&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;message&#34;</span>: message,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;username&#34;</span>: username,
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chat_message</span>(self, event):
</span></span><span style="display:flex;"><span>        message <span style="color:#f92672">=</span> event[<span style="color:#e6db74">&#34;message&#34;</span>]
</span></span><span style="display:flex;"><span>        username <span style="color:#f92672">=</span> event[<span style="color:#e6db74">&#34;username&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        message_html <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&lt;div hx-swap-oob=&#39;beforeend:#messages&#39;&gt;&lt;p&gt;&lt;b&gt;</span><span style="color:#e6db74">{</span>username<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/b&gt;: </span><span style="color:#e6db74">{</span>message<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/p&gt;&lt;/div&gt;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>send(
</span></span><span style="display:flex;"><span>            text_data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;message&#34;</span>: message_html,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;username&#34;</span>: username
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@sync_to_async</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">save_message</span>(self, room, user, message):
</span></span><span style="display:flex;"><span>        room <span style="color:#f92672">=</span> Room<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>get(slug<span style="color:#f92672">=</span>room)
</span></span><span style="display:flex;"><span>        Message<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>create(room<span style="color:#f92672">=</span>room, user<span style="color:#f92672">=</span>user, message<span style="color:#f92672">=</span>message)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@sync_to_async</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_user</span>(self, room, user):
</span></span><span style="display:flex;"><span>        room <span style="color:#f92672">=</span> Room<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>get(slug<span style="color:#f92672">=</span>room)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> user <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> room<span style="color:#f92672">.</span>users<span style="color:#f92672">.</span>all():
</span></span><span style="display:flex;"><span>            room<span style="color:#f92672">.</span>users<span style="color:#f92672">.</span>add(user)
</span></span><span style="display:flex;"><span>            room<span style="color:#f92672">.</span>save()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@sync_to_async</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">remove_user</span>(self, room, user):
</span></span><span style="display:flex;"><span>        room <span style="color:#f92672">=</span> Room<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>get(slug<span style="color:#f92672">=</span>room)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> user <span style="color:#f92672">in</span> room<span style="color:#f92672">.</span>users<span style="color:#f92672">.</span>all():
</span></span><span style="display:flex;"><span>            room<span style="color:#f92672">.</span>users<span style="color:#f92672">.</span>remove(user)
</span></span><span style="display:flex;"><span>            room<span style="color:#f92672">.</span>save()</span></span></code></pre></div></div>
<p>So, we have created a few methods like <code>save_message</code>, <code>add_user</code>, and <code>remove_user</code> which all are <code>synchronous</code> methods but we are using an asynchronous web server, so we add in the <code>sync_to_async</code> decorator which wraps a synchronous method to an asynchronous method. Inside the methods, we simply perform the database operations like creating a message object, and adding or removing the user from the room.</p>
<p>That&rsquo;s only a few features that I have added, you can add to this application and customize them as per your needs.</p>
<p>The code for this chat app is provided in the <a href="https://github.com/Mr-Destructive/django-htmx-chat"  target="_blank">GitHub repository</a>.</p>

<h2 class="relative group">Conclusion
    <div id="conclusion" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#conclusion" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>So, from this post, we were able to create a simple chat app (frontendless) with Django and htmx. We used Django channels and HTMX to make a chat application without the need to write javascript for the client-side connection. Hope you found this tutorial helpful, do give your feedback and thoughts on it, I&rsquo;ll be eager to improve this post. Thank you for your patient listening. Happy Coding :)</p>

          
          
          
        </div>
        
        
        

        

      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js"
          integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA=="
          data-oid="views_posts/2023-02-05-Django-HTMX-Chat-App.md"
          data-oid-likes="likes_posts/2023-02-05-Django-HTMX-Chat-App.md"></script>
      
    </section>

    
    <footer class="pt-8 max-w-prose print:hidden">
      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
      <div class="flex justify-between pt-3">
        <span class="flex flex-col">
          
            <a
              class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="/posts/golang-command-line-args/">
              <span class="leading-6">
                <span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Golang: Command Line Arguments
              </span>
            </a>
            
              <span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2023-01-07T21:30:00&#43;00:00">January 7, 2023</time>
              </span>
            
          
        </span>
        <span class="flex flex-col items-end">
          
            <a
              class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="/posts/golang-regex/">
              <span class="leading-6">
                Golang: Regex&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
              </span>
            </a>
            
              <span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2023-03-22T12:30:00&#43;00:00">March 22, 2023</time>
              </span>
            
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        


  






<div
  id="scroll-to-top"
  class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200">
  <a
    href="#the-top"
    class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2026
          Meet Gor
      </p>
    

    
    
      <p class="text-xs text-neutral-500 dark:text-neutral-400">
        
        
        Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
      </p>
    
  </div>
  
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  
  
  
  <script
    type="text/javascript"
    src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500"
  data-url="/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
