<!doctype html>
<html
  lang="en-us"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"><head>
  <meta charset="utf-8">
  
    <meta http-equiv="content-language" content="en-us">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color">

  
  
    <title>Advent of SQL 2025 Day 12: Archive Flight Records &middot; Notes</title>
    <meta name="title" content="Advent of SQL 2025 Day 12: Archive Flight Records &middot; Notes">
  

  
  
    <meta name="description" content="A collection of technical notes and posts">
  
  
    <meta name="keywords" content="sqlite,sql,advent-of-sql,">
  
  
  
  <link rel="canonical" href="/posts/advent-of-sql-2025-day-12/">
  

  
  
    <meta name="author" content="Meet Gor">
  
  

  
  <meta property="og:url" content="/posts/advent-of-sql-2025-day-12/">
  <meta property="og:site_name" content="Notes">
  <meta property="og:title" content="Advent of SQL 2025 Day 12: Archive Flight Records">
  <meta property="og:description" content="Advent of SQL - Day 12, Archive Flight Records # We are on Day 12! Phew its almost done! Just 3 days more!
Let’s get the SQL!
DROP TABLE IF EXISTS archive_records; CREATE TABLE archive_records ( id INT PRIMARY KEY, title TEXT, description TEXT ); INSERT INTO archive_records (id, title, description) VALUES (1, &#39;Flight Stabilization Prototype Analysis&#39;, &#39;This report details the latest advancements in stabilizing aerial maneuvers for enchanted sleighs. Initial tests yielded promising results, showcasing a marked decrease in turbulence during airborne navigation.&#39;), (2, &#39;Lift Calibration Incident Log&#39;, &#39;During a routine lift calibration test, the sleigh experienced an unexpected upward surge, causing it to hover dangerously close to the workshop ceiling. Subsequent analysis revealed a miscalculation in the weight distribution formula, prompting a thorough review of all aerodynamic coefficients.&#39;), (3, &#39;Aerial Aspirations: The Great Flop&#39;, &#39;Despite the initial excitement surrounding the design of our feather-laden airborne contraption, the prototype proved less than buoyant. The unexpected descent resulted in a rather spectacular cloud of glitter and twigs, serving as a vivid reminder that not all dreams of flight take wing as intended.&#39;), (4, &#39;Optimized Sled Dynamics&#39;, &#39;This document explores advanced mechanics behind sled propulsion and movement efficiency. Through extensive calculations and enchanted material tests, the elves aim to refine turning capabilities and enhance downhill speed.&#39;), (5, &#39;Reindeer Harness Design Flaws&#39;, &#39;The latest prototype of our reindeer harness was found to inhibit mobility, causing undue strain on the animals during testing. Observations indicated that the weight distribution was poorly calibrated, necessitating a complete redesign for optimal comfort and performance.&#39;), (6, &#39;Streamlined Cargo Routing System&#39;, &#39;In our latest endeavor, we have implemented a magical algorithm to optimize the route taken by our toy-laden sleighs. This groundbreaking update minimizes transport time between the workshop and delivery points, ensuring that holiday cheer reaches every home even faster!&#39;), (7, &#39;Toy Durability Testing Protocols&#39;, &#39;The elves meticulously conducted stress evaluations on the latest toy prototypes to determine their resilience under various conditions. Initial findings indicate that while some designs withstood rigorous play, others required reinforcements to avoid premature wear and tear.&#39;), (8, &#39;Weather Resistance Breakthrough: Frost Shielding&#39;, &#39;In our recent experiments, we discovered an innovative composite material that effectively repels moisture while withstanding extreme cold. This newfound frost shielding could revolutionize our outdoor toys, ensuring they remain both functional and enchanting, even in the harshest winter conditions.&#39;), (9, &#39;Safety Compliance Check Overview&#39;, &#39;In the pursuit of enchantment and joy, this document outlines the mandatory safety compliance measures for all workshop operations. Each elf must adhere strictly to these guidelines to ensure the safe transport and handling of our delicate prototypes, thus preventing any unforeseen magical mishaps.&#39;), (10, &#39;Sleigh Skim Mechanism Upgrade&#39;, &#39;The experiment involved enchanting the underside of the sleigh with a whispering wind charm to achieve unprecedented speeds. Results were alarming, leading to uncontrollable flight trajectories and sudden descents—definitely do not attempt again.&#39;), (11, &#39;Caution: Enchanted Toy Prototype&#39;, &#39;This design incorporates a reactive magic component that may unpredictably animate in the presence of mischief. Ensure all test environments are secured against spontaneous giggles and potential chaos.&#39;), (12, &#39;Workshop Experiment Safety Checklist&#39;, &#39;Before embarking on any workshop experiments, ensure all safety goggles are securely fastened to prevent debris from interfered visions. Always double-check that the workspace is free of clutter, as unexpected accidents can arise from even the smallest flurry of trinkets and tools.&#39;), (13, &#39;Cocoa Bean Roasting Innovations&#39;, &#39;This review explores the latest techniques in roasting cocoa beans to achieve unparalleled flavor profiles. Adjustments to temperature and timing have led to a delightful spectrum of aromas, promising to elevate our confectionery creations to new heights.&#39;), (14, &#39;Intricate Snowflake Ornament Design&#39;, &#39;This design blueprint outlines the geometric intricacies of a multi-faceted snowflake ornament, emphasizing a balance between elegance and structural integrity. Each arm is meticulously patterned to reflect light, creating a shimmering effect that dances with the seasons, while ensuring optimal symmetry for enchanting visual appeal.&#39;), (15, &#39;Gift Box Assembly Prototype&#39;, &#39;This prototype outlines the intricate process of assembling the enchanted gift boxes designed to withstand the whims of time and space. Each step must be meticulously executed to ensure that every box not only sparkles with joy but also maintains its magical properties through every unwrapping.&#39;), (16, &#39;Wrap-It-Up: Innovative Designs&#39;, &#39;This experimental report explores various materials and techniques for creating enchanted wrapping paper that enhances the gift-giving experience. Initial findings suggest that incorporation of shimmering elven dust can amplify the aesthetic appeal while maintaining structural integrity during airborne delivery.&#39;), (17, &#39;Magical Confection Fusion Results&#39;, &#39;The experimental concoction blended sugar crystals with essence of starlight, resulting in a luminescent treat that sparkles enchantingly. However, a curious side effect was noted: excessive giggling among taste testers, raising questions about potential airborne laughter.&#39;), (18, &#39;Luminous Ornament Crafting Techniques&#39;, &#39;In our continuous pursuit of radiance, this document outlines innovative methods for creating ornaments that glow with enchantment. Engaging both traditional techniques and modern enchantments, each design is meant to instill joy and sparkle during the festive season.&#39;), (19, &#39;Magical Energy Conduction Analysis&#39;, &#39;Recent experiments have shown that the flow of magical energy through crystalline conduits behaves unpredictably under varying lunar phases. Further investigation into the correlation between ambient mana levels and energy stability is necessary to optimize enchantment potency.&#39;), (20, &#39;Elven Workshop Organization Protocols&#39;, &#39;The implementation of open shelving systems has significantly increased accessibility to essential materials, thus enhancing workflow efficiency. Furthermore, the organization of tools into color-coded bins ensures that each elf can swiftly locate their required implements without disrupting the harmony of the workshop.&#39;); We have just one table and a couple of text like columns. That’s it, looks like a string searching problem.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-12-27T15:30:00+05:30">
    <meta property="article:modified_time" content="2026-01-04T15:32:35+05:30">
    <meta property="article:tag" content="Sqlite">
    <meta property="article:tag" content="Sql">
    <meta property="article:tag" content="Advent-of-Sql">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Advent of SQL 2025 Day 12: Archive Flight Records">
  <meta name="twitter:description" content="Advent of SQL - Day 12, Archive Flight Records # We are on Day 12! Phew its almost done! Just 3 days more!
Let’s get the SQL!
DROP TABLE IF EXISTS archive_records; CREATE TABLE archive_records ( id INT PRIMARY KEY, title TEXT, description TEXT ); INSERT INTO archive_records (id, title, description) VALUES (1, &#39;Flight Stabilization Prototype Analysis&#39;, &#39;This report details the latest advancements in stabilizing aerial maneuvers for enchanted sleighs. Initial tests yielded promising results, showcasing a marked decrease in turbulence during airborne navigation.&#39;), (2, &#39;Lift Calibration Incident Log&#39;, &#39;During a routine lift calibration test, the sleigh experienced an unexpected upward surge, causing it to hover dangerously close to the workshop ceiling. Subsequent analysis revealed a miscalculation in the weight distribution formula, prompting a thorough review of all aerodynamic coefficients.&#39;), (3, &#39;Aerial Aspirations: The Great Flop&#39;, &#39;Despite the initial excitement surrounding the design of our feather-laden airborne contraption, the prototype proved less than buoyant. The unexpected descent resulted in a rather spectacular cloud of glitter and twigs, serving as a vivid reminder that not all dreams of flight take wing as intended.&#39;), (4, &#39;Optimized Sled Dynamics&#39;, &#39;This document explores advanced mechanics behind sled propulsion and movement efficiency. Through extensive calculations and enchanted material tests, the elves aim to refine turning capabilities and enhance downhill speed.&#39;), (5, &#39;Reindeer Harness Design Flaws&#39;, &#39;The latest prototype of our reindeer harness was found to inhibit mobility, causing undue strain on the animals during testing. Observations indicated that the weight distribution was poorly calibrated, necessitating a complete redesign for optimal comfort and performance.&#39;), (6, &#39;Streamlined Cargo Routing System&#39;, &#39;In our latest endeavor, we have implemented a magical algorithm to optimize the route taken by our toy-laden sleighs. This groundbreaking update minimizes transport time between the workshop and delivery points, ensuring that holiday cheer reaches every home even faster!&#39;), (7, &#39;Toy Durability Testing Protocols&#39;, &#39;The elves meticulously conducted stress evaluations on the latest toy prototypes to determine their resilience under various conditions. Initial findings indicate that while some designs withstood rigorous play, others required reinforcements to avoid premature wear and tear.&#39;), (8, &#39;Weather Resistance Breakthrough: Frost Shielding&#39;, &#39;In our recent experiments, we discovered an innovative composite material that effectively repels moisture while withstanding extreme cold. This newfound frost shielding could revolutionize our outdoor toys, ensuring they remain both functional and enchanting, even in the harshest winter conditions.&#39;), (9, &#39;Safety Compliance Check Overview&#39;, &#39;In the pursuit of enchantment and joy, this document outlines the mandatory safety compliance measures for all workshop operations. Each elf must adhere strictly to these guidelines to ensure the safe transport and handling of our delicate prototypes, thus preventing any unforeseen magical mishaps.&#39;), (10, &#39;Sleigh Skim Mechanism Upgrade&#39;, &#39;The experiment involved enchanting the underside of the sleigh with a whispering wind charm to achieve unprecedented speeds. Results were alarming, leading to uncontrollable flight trajectories and sudden descents—definitely do not attempt again.&#39;), (11, &#39;Caution: Enchanted Toy Prototype&#39;, &#39;This design incorporates a reactive magic component that may unpredictably animate in the presence of mischief. Ensure all test environments are secured against spontaneous giggles and potential chaos.&#39;), (12, &#39;Workshop Experiment Safety Checklist&#39;, &#39;Before embarking on any workshop experiments, ensure all safety goggles are securely fastened to prevent debris from interfered visions. Always double-check that the workspace is free of clutter, as unexpected accidents can arise from even the smallest flurry of trinkets and tools.&#39;), (13, &#39;Cocoa Bean Roasting Innovations&#39;, &#39;This review explores the latest techniques in roasting cocoa beans to achieve unparalleled flavor profiles. Adjustments to temperature and timing have led to a delightful spectrum of aromas, promising to elevate our confectionery creations to new heights.&#39;), (14, &#39;Intricate Snowflake Ornament Design&#39;, &#39;This design blueprint outlines the geometric intricacies of a multi-faceted snowflake ornament, emphasizing a balance between elegance and structural integrity. Each arm is meticulously patterned to reflect light, creating a shimmering effect that dances with the seasons, while ensuring optimal symmetry for enchanting visual appeal.&#39;), (15, &#39;Gift Box Assembly Prototype&#39;, &#39;This prototype outlines the intricate process of assembling the enchanted gift boxes designed to withstand the whims of time and space. Each step must be meticulously executed to ensure that every box not only sparkles with joy but also maintains its magical properties through every unwrapping.&#39;), (16, &#39;Wrap-It-Up: Innovative Designs&#39;, &#39;This experimental report explores various materials and techniques for creating enchanted wrapping paper that enhances the gift-giving experience. Initial findings suggest that incorporation of shimmering elven dust can amplify the aesthetic appeal while maintaining structural integrity during airborne delivery.&#39;), (17, &#39;Magical Confection Fusion Results&#39;, &#39;The experimental concoction blended sugar crystals with essence of starlight, resulting in a luminescent treat that sparkles enchantingly. However, a curious side effect was noted: excessive giggling among taste testers, raising questions about potential airborne laughter.&#39;), (18, &#39;Luminous Ornament Crafting Techniques&#39;, &#39;In our continuous pursuit of radiance, this document outlines innovative methods for creating ornaments that glow with enchantment. Engaging both traditional techniques and modern enchantments, each design is meant to instill joy and sparkle during the festive season.&#39;), (19, &#39;Magical Energy Conduction Analysis&#39;, &#39;Recent experiments have shown that the flow of magical energy through crystalline conduits behaves unpredictably under varying lunar phases. Further investigation into the correlation between ambient mana levels and energy stability is necessary to optimize enchantment potency.&#39;), (20, &#39;Elven Workshop Organization Protocols&#39;, &#39;The implementation of open shelving systems has significantly increased accessibility to essential materials, thus enhancing workflow efficiency. Furthermore, the organization of tools into color-coded bins ensures that each elf can swiftly locate their required implements without disrupting the harmony of the workshop.&#39;); We have just one table and a couple of text like columns. That’s it, looks like a string searching problem.">

  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
  
    
  

  
  
  
  
  
  

  

  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.c61736128cfa071f52268b924e8b8c8dff7f9e962caae1e812053e9e023a4e1c1c95239d517406a4002933de9dd5ad84667956aa9d4230a25024e7e502058ca1.css"
    integrity="sha512-xhc2Eoz6Bx9SJouSTouMjf9/npYsquHoEgU&#43;ngI6ThwclSOdUXQGpAApM96d1a2EZnlWqp1CMKJQJOflAgWMoQ==">

  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js"
    integrity="sha512-b0EXSzoFtoCCD&#43;CMrb&#43;l&#43;3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script>
  
  
  
  
  
  
    
    <script src="/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js" integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7&#43;kfJ6kKCJxQGC&#43;8wm&#43;Bz9JucDjDTGNew=="></script>
  

  
  
  
    
  
  
    
  
  
  
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.67624a357c928d29b9fe19ba01a1e32c05ad1329ca2a712bf10446df0c6872903d0c14b21f76896b57a5a0710940805416cee38851d9067db6555881188e35a5.js"
      integrity="sha512-Z2JKNXySjSm5/hm6AaHjLAWtEynKKnEr8QRG3wxocpA9DBSyH3aJa1eloHEJQIBUFs7jiFHZBn22VViBGI41pQ=="
      data-copy="Copy"
      data-copied="Copied"></script>
  

  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>


























  

  

  

  

  








  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
  

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Advent of SQL 2025 Day 12: Archive Flight Records",
    "headline": "Advent of SQL 2025 Day 12: Archive Flight Records",
    
    "inLanguage": "en-us",
    "url" : "/posts/advent-of-sql-2025-day-12/",
    "author" : {
      "@type": "Person",
      "name": "Meet Gor"
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-12-27T15:30:00\u002b05:30",
    "datePublished": "2025-12-27T15:30:00\u002b05:30",
    
    "dateModified": "2026-01-04T15:32:35\u002b05:30",
    
    "keywords": ["sqlite","sql","advent-of-sql"],
    
    "mainEntityOfPage": "true",
    "wordCount": "2499"
  }]
  </script>



  
  
    




  

  
  

  
  

  
  

  
  
</head>


















  
  <body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        Skip to main content
      </a>
    </div>
    
    
      <div class="main-menu flex items-center w-full gap-2 p-1 pl-0">
  
  
    <a href="/" class="text-base font-medium truncate min-w-0 shrink">
      Notes
    </a>
  
  <div class="flex items-center ms-auto">
    <div class="hidden md:flex">
      <nav class="flex items-center gap-x-5 h-12">
  
    
      
  
    <a
      href="/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="Home"
      title="">
      
      
        <span class="text-base font-medium break-normal">
          Home
        </span>
      
    </a>
  

    
      
  
    <a
      href="/posts/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="Posts"
      title="">
      
      
        <span class="text-base font-medium break-normal">
          Posts
        </span>
      
    </a>
  

    
      
  
    <a
      href="/tags/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="Tags"
      title="">
      
      
        <span class="text-base font-medium break-normal">
          Tags
        </span>
      
    </a>
  

    
  

  

  

  
    <button
      id="search-button"
      aria-label="Search"
      class="text-base bf-icon-color-hover"
      title="Search (/)">
      <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
    </button>
  

  
    <div class="flex items-center">
      <button
        id="appearance-switcher"
        aria-label="Dark mode switcher"
        type="button"
        class="text-base bf-icon-color-hover">
        <div class="flex items-center justify-center dark:hidden">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
        </div>
        <div class="items-center justify-center hidden dark:flex">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
        </div>
      </button>
    </div>
  
</nav>



    </div>
    <div class="flex md:hidden">
      <div class="flex items-center h-14 gap-4">
  
    <button
      id="search-button-mobile"
      aria-label="Search"
      class="flex items-center justify-center bf-icon-color-hover"
      title="Search (/)">
      <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
    </button>
  

  
    <button
      id="appearance-switcher-mobile"
      type="button"
      aria-label="Dark mode switcher"
      class="flex items-center justify-center text-neutral-900 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400">
      <div class="dark:hidden">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
      </div>
      <div class="hidden dark:block">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
      </div>
    </button>
  

  
    <input type="checkbox" id="mobile-menu-toggle" autocomplete="off" class="hidden peer">
    <label for="mobile-menu-toggle" class="flex items-center justify-center cursor-pointer bf-icon-color-hover">
      <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
    </label>

    <div
      role="dialog"
      aria-modal="true"
      style="scrollbar-gutter: stable;"
      class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
      bf-scrollbar">
      <label
        for="mobile-menu-toggle"
        class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </label>
      <nav class="mx-auto max-w-md space-y-6">
        
  
    
    <div class="px-2">
      <a
        href="/"
        aria-label="Home"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="" class="text-2xl font-bold tracking-tight">
          Home
        </span>
        
      </a>

      
    </div>
  
    
    <div class="px-2">
      <a
        href="/posts/"
        aria-label="Posts"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="" class="text-2xl font-bold tracking-tight">
          Posts
        </span>
        
      </a>

      
    </div>
  
    
    <div class="px-2">
      <a
        href="/tags/"
        aria-label="Tags"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="" class="text-2xl font-bold tracking-tight">
          Tags
        </span>
        
      </a>

      
    </div>
  

        
  

        
  

      </nav>
    </div>
  
</div>







    </div>
  </div>
</div>





    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  
  <article>
    
    

    
    <header id="single_header" class="mt-5 max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Advent of SQL 2025 Day 12: Archive Flight Records
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  
    
  

  

  
    
  

  

  
    
  

  
    
  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2025-12-27T15:30:00&#43;05:30">December 27, 2025</time><span class="px-2 text-primary-500">&middot;</span><span>2499 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">12 mins</span>
    

    
    
  </div>

  

  
  

  
  



      </div>
      
        
  
  
  
  
  
  

  

  
    
    
<div class="flex author">
  
  <div class="place-self-center">
    
      <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
        Author
      </div>
      <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
        Meet Gor
      </div>
    
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>

  

  

  
    <div class="mb-5"></div>
  

      
    </header>

    
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
      
      
      
      


      <div class="min-w-0 min-h-0 max-w-fit">
        
        <div class="article-content max-w-prose mb-20">
          
<h2 class="relative group">Advent of SQL - Day 12, Archive Flight Records
    <div id="advent-of-sql---day-12-archive-flight-records" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#advent-of-sql---day-12-archive-flight-records" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>We are on Day 12! Phew its almost done! Just 3 days more!</p>
<p>Let&rsquo;s get the SQL!</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> archive_records;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> archive_records (
</span></span><span style="display:flex;"><span>    id INT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
</span></span><span style="display:flex;"><span>    title TEXT,
</span></span><span style="display:flex;"><span>    description TEXT
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> archive_records (id, title, description) <span style="color:#66d9ef">VALUES</span>
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;Flight Stabilization Prototype Analysis&#39;</span>, <span style="color:#e6db74">&#39;This report details the latest advancements in stabilizing aerial maneuvers for enchanted sleighs. Initial tests yielded promising results, showcasing a marked decrease in turbulence during airborne navigation.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;Lift Calibration Incident Log&#39;</span>, <span style="color:#e6db74">&#39;During a routine lift calibration test, the sleigh experienced an unexpected upward surge, causing it to hover dangerously close to the workshop ceiling. Subsequent analysis revealed a miscalculation in the weight distribution formula, prompting a thorough review of all aerodynamic coefficients.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;Aerial Aspirations: The Great Flop&#39;</span>, <span style="color:#e6db74">&#39;Despite the initial excitement surrounding the design of our feather-laden airborne contraption, the prototype proved less than buoyant. The unexpected descent resulted in a rather spectacular cloud of glitter and twigs, serving as a vivid reminder that not all dreams of flight take wing as intended.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;Optimized Sled Dynamics&#39;</span>, <span style="color:#e6db74">&#39;This document explores advanced mechanics behind sled propulsion and movement efficiency. Through extensive calculations and enchanted material tests, the elves aim to refine turning capabilities and enhance downhill speed.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#39;Reindeer Harness Design Flaws&#39;</span>, <span style="color:#e6db74">&#39;The latest prototype of our reindeer harness was found to inhibit mobility, causing undue strain on the animals during testing. Observations indicated that the weight distribution was poorly calibrated, necessitating a complete redesign for optimal comfort and performance.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#39;Streamlined Cargo Routing System&#39;</span>, <span style="color:#e6db74">&#39;In our latest endeavor, we have implemented a magical algorithm to optimize the route taken by our toy-laden sleighs. This groundbreaking update minimizes transport time between the workshop and delivery points, ensuring that holiday cheer reaches every home even faster!&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">7</span>, <span style="color:#e6db74">&#39;Toy Durability Testing Protocols&#39;</span>, <span style="color:#e6db74">&#39;The elves meticulously conducted stress evaluations on the latest toy prototypes to determine their resilience under various conditions. Initial findings indicate that while some designs withstood rigorous play, others required reinforcements to avoid premature wear and tear.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#39;Weather Resistance Breakthrough: Frost Shielding&#39;</span>, <span style="color:#e6db74">&#39;In our recent experiments, we discovered an innovative composite material that effectively repels moisture while withstanding extreme cold. This newfound frost shielding could revolutionize our outdoor toys, ensuring they remain both functional and enchanting, even in the harshest winter conditions.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">9</span>, <span style="color:#e6db74">&#39;Safety Compliance Check Overview&#39;</span>, <span style="color:#e6db74">&#39;In the pursuit of enchantment and joy, this document outlines the mandatory safety compliance measures for all workshop operations. Each elf must adhere strictly to these guidelines to ensure the safe transport and handling of our delicate prototypes, thus preventing any unforeseen magical mishaps.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#39;Sleigh Skim Mechanism Upgrade&#39;</span>, <span style="color:#e6db74">&#39;The experiment involved enchanting the underside of the sleigh with a whispering wind charm to achieve unprecedented speeds. Results were alarming, leading to uncontrollable flight trajectories and sudden descents—definitely do not attempt again.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">11</span>, <span style="color:#e6db74">&#39;Caution: Enchanted Toy Prototype&#39;</span>, <span style="color:#e6db74">&#39;This design incorporates a reactive magic component that may unpredictably animate in the presence of mischief. Ensure all test environments are secured against spontaneous giggles and potential chaos.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">12</span>, <span style="color:#e6db74">&#39;Workshop Experiment Safety Checklist&#39;</span>, <span style="color:#e6db74">&#39;Before embarking on any workshop experiments, ensure all safety goggles are securely fastened to prevent debris from interfered visions. Always double-check that the workspace is free of clutter, as unexpected accidents can arise from even the smallest flurry of trinkets and tools.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">13</span>, <span style="color:#e6db74">&#39;Cocoa Bean Roasting Innovations&#39;</span>, <span style="color:#e6db74">&#39;This review explores the latest techniques in roasting cocoa beans to achieve unparalleled flavor profiles. Adjustments to temperature and timing have led to a delightful spectrum of aromas, promising to elevate our confectionery creations to new heights.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">14</span>, <span style="color:#e6db74">&#39;Intricate Snowflake Ornament Design&#39;</span>, <span style="color:#e6db74">&#39;This design blueprint outlines the geometric intricacies of a multi-faceted snowflake ornament, emphasizing a balance between elegance and structural integrity. Each arm is meticulously patterned to reflect light, creating a shimmering effect that dances with the seasons, while ensuring optimal symmetry for enchanting visual appeal.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">15</span>, <span style="color:#e6db74">&#39;Gift Box Assembly Prototype&#39;</span>, <span style="color:#e6db74">&#39;This prototype outlines the intricate process of assembling the enchanted gift boxes designed to withstand the whims of time and space. Each step must be meticulously executed to ensure that every box not only sparkles with joy but also maintains its magical properties through every unwrapping.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">16</span>, <span style="color:#e6db74">&#39;Wrap-It-Up: Innovative Designs&#39;</span>, <span style="color:#e6db74">&#39;This experimental report explores various materials and techniques for creating enchanted wrapping paper that enhances the gift-giving experience. Initial findings suggest that incorporation of shimmering elven dust can amplify the aesthetic appeal while maintaining structural integrity during airborne delivery.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">17</span>, <span style="color:#e6db74">&#39;Magical Confection Fusion Results&#39;</span>, <span style="color:#e6db74">&#39;The experimental concoction blended sugar crystals with essence of starlight, resulting in a luminescent treat that sparkles enchantingly. However, a curious side effect was noted: excessive giggling among taste testers, raising questions about potential airborne laughter.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">18</span>, <span style="color:#e6db74">&#39;Luminous Ornament Crafting Techniques&#39;</span>, <span style="color:#e6db74">&#39;In our continuous pursuit of radiance, this document outlines innovative methods for creating ornaments that glow with enchantment. Engaging both traditional techniques and modern enchantments, each design is meant to instill joy and sparkle during the festive season.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">19</span>, <span style="color:#e6db74">&#39;Magical Energy Conduction Analysis&#39;</span>, <span style="color:#e6db74">&#39;Recent experiments have shown that the flow of magical energy through crystalline conduits behaves unpredictably under varying lunar phases. Further investigation into the correlation between ambient mana levels and energy stability is necessary to optimize enchantment potency.&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">20</span>, <span style="color:#e6db74">&#39;Elven Workshop Organization Protocols&#39;</span>, <span style="color:#e6db74">&#39;The implementation of open shelving systems has significantly increased accessibility to essential materials, thus enhancing workflow efficiency. Furthermore, the organization of tools into color-coded bins ensures that each elf can swiftly locate their required implements without disrupting the harmony of the workshop.&#39;</span>);</span></span></code></pre></div></div>
<p>We have just one table and a couple of text like columns. That&rsquo;s it, looks like a string searching problem.</p>
<p>Let&rsquo;s head to the problem statement!</p>

<h2 class="relative group">Problem
    <div id="problem" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#problem" aria-label="Anchor">#</a>
    </span>
    
</h2>
<blockquote><p>Using the <code>archive_records</code> table, search both the <code>title</code> and <code>description</code> fields for the term &ldquo;fly&rdquo;. Make sure that you also match for words like &ldquo;flying&rdquo;, &ldquo;flight&rdquo;, etc. Boost the results where the term appears in the title and lastly, rank the results by relevance (most relevant first). Provide the elves the top 5 most relevant archived records back.</p>
</blockquote><p>It is a text search use case problem indeed!</p>
<p>We need to find and rank the records matching the word <code>fly</code>, <code>flying</code>, <code>flight</code> like those. Kind of tricky if we miss any terms that are not hard-coded.</p>
<p>We need to boost the search term in <code>title</code>, so there is more weightage if the term appears in title than in description. Makes sense!</p>
<p>Let&rsquo;s start simple and move into full-text-search in SQLite!</p>

<h3 class="relative group">Simple String Matching
    <div id="simple-string-matching" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#simple-string-matching" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We start by a simple nested <code>CASE WHEN THEN</code> condition. We check if the <code>title</code> has <code>fly</code>, <code>flying</code>, <code>flight</code>, etc then we set the rank as <code>2</code> and add the score from <code>description</code> as <code>1</code> if the same terms appear in description.</p>
<p>So,</p>
<ul>
<li>If the search term (fly, flight, etc) appears <strong>only</strong> in title, score is <code>2</code></li>
<li>If the search term appears <strong>only</strong> in description, score is <code>1</code></li>
<li>If the search term appears in <strong>both</strong> title and description, the score is <code>3</code> since we are adding the scores.</li>
<li>If the search term doesn&rsquo;t appear at all, then the score remains <code>0</code>.</li>
</ul>
<p>We simply assign the score based on the appearance of the search term and then order the result based on the computed <code>rank</code> and list the top 5.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span> <span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    id,
</span></span><span style="display:flex;"><span>    title,
</span></span><span style="display:flex;"><span>    description,
</span></span><span style="display:flex;"><span>    (
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span> <span style="color:#66d9ef">THEN</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">END</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span> <span style="color:#66d9ef">THEN</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">END</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">AS</span> rank
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> archive_records
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> rank <span style="color:#66d9ef">DESC</span>, id <span style="color:#66d9ef">ASC</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">5</span>;</span></span></code></pre></div></div>
<p>However, we can limit the search space by eliminating the computation of ranking all the records with a <code>WHERE</code> clause since it can optimise only the relevant records before giving out the result set.</p>
<p>Hence, we filter only in the cases where the <code>title</code> and <code>description</code> have the relevant word and then use the condition to order by the <code>rank</code> score that we computed and list the top <code>5</code> ones.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    id,
</span></span><span style="display:flex;"><span>    title,
</span></span><span style="display:flex;"><span>    description,
</span></span><span style="display:flex;"><span>    (
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">-- Title matches worth 2 points (boosted relevance)
</span></span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span> <span style="color:#66d9ef">THEN</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">END</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">-- Description matches worth 1 point
</span></span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span> <span style="color:#66d9ef">THEN</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">END</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">AS</span> rank
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> archive_records
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span> <span style="color:#66d9ef">OR</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> rank <span style="color:#66d9ef">DESC</span>, id <span style="color:#66d9ef">ASC</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">5</span>;</span></span></code></pre></div></div>
<p>We can wrap it in a CTE, but that doesn&rsquo;t does anything differently though.</p>
<p>With CTE as below, we assign a common score like <code>1</code> or <code>0</code> based on the <code>title</code> or description match. Then in the outer query, we can assign a weight to the rank if the <code>title</code> matched as <code>2</code> or <code>description</code> matched as <code>1</code> and add it up to get the same <code>rank</code> for that record.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">WITH</span> search_results <span style="color:#66d9ef">AS</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>        id,
</span></span><span style="display:flex;"><span>        title,
</span></span><span style="display:flex;"><span>        description,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">THEN</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">AS</span> title_match,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">THEN</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">AS</span> desc_match
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FROM</span> archive_records
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">WHERE</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span> <span style="color:#66d9ef">OR</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    id,
</span></span><span style="display:flex;"><span>    title,
</span></span><span style="display:flex;"><span>    description,
</span></span><span style="display:flex;"><span>    (title_match <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> desc_match <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">AS</span> rank
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> search_results
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> rank <span style="color:#66d9ef">DESC</span>, id <span style="color:#66d9ef">ASC</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">5</span>;</span></span></code></pre></div></div>

<h3 class="relative group">Assign score based on matching frequency
    <div id="assign-score-based-on-matching-frequency" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#assign-score-based-on-matching-frequency" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We can also make it better by counting how many times the term appeared in the relevant column and then compute a cumulative rank. This way it becomes more aggressive on the most relevant docs only.</p>
<p>So, we write something like this.</p>
<ul>
<li>Compute the length of the full column example as title with <code>LENGTH(LOWER(title)</code> then subtract the length of the word left after removing <code>fly</code>, or <code>flight</code>, or others. It calculates the difference in length between the original title and the one with &lsquo;fly&rsquo; removed. Each &lsquo;fly&rsquo; is 3 characters, so the difference divided by 3 gives the number of occurrences of &lsquo;fly&rsquo;. This <code>(LENGTH(LOWER(title)) - LENGTH(REPLACE(LOWER(title), 'fly', ''))) / 3 </code> counts how many times &lsquo;fly&rsquo; appears. Similarly for <code>flight</code> and <code>flying</code> it is <code>6</code>, and so on.</li>
<li>If that appears in title it is multiplied by <code>2</code></li>
<li>If it appears in description, it is kept as is (multiplied by <code>1</code>) but you can weight it accordingly, as there could be multiple column to weigh.</li>
</ul>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    id,
</span></span><span style="display:flex;"><span>    title,
</span></span><span style="display:flex;"><span>    description,
</span></span><span style="display:flex;"><span>    (
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ((<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(title)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(title), <span style="color:#e6db74">&#39;fly&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(title)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(title), <span style="color:#e6db74">&#39;flight&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(title)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(title), <span style="color:#e6db74">&#39;flying&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>        ) <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ((<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(description)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(description), <span style="color:#e6db74">&#39;fly&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(description)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(description), <span style="color:#e6db74">&#39;flight&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(description)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(description), <span style="color:#e6db74">&#39;flying&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">AS</span> rank
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> archive_records
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> rank <span style="color:#66d9ef">DESC</span>, id <span style="color:#66d9ef">ASC</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">5</span>;</span></span></code></pre></div></div>
<p>You can always add a where clause to reduce the search space upfront:</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Simplified frequency-based ranking
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    id,
</span></span><span style="display:flex;"><span>    title,
</span></span><span style="display:flex;"><span>    description,
</span></span><span style="display:flex;"><span>    (
</span></span><span style="display:flex;"><span>        ((<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(title)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(title), <span style="color:#e6db74">&#39;fly&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(title)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(title), <span style="color:#e6db74">&#39;flight&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(title)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(title), <span style="color:#e6db74">&#39;flying&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>        ) <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        ((<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(description)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(description), <span style="color:#e6db74">&#39;fly&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(description)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(description), <span style="color:#e6db74">&#39;flight&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(description)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(description), <span style="color:#e6db74">&#39;flying&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">AS</span> rank
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> archive_records
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(title) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span> <span style="color:#66d9ef">OR</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">LOWER</span>(description) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> rank <span style="color:#66d9ef">DESC</span>, id <span style="color:#66d9ef">ASC</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">5</span>;</span></span></code></pre></div></div>
<p>This would give us similar results but slightly different as we are assigning rank on the number of times each term appears and not just if it appears once or not.</p>
<p>We can even make the list of words and their weight as a CTE and dynamically use it in the actual query:</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">WITH</span> keywords <span style="color:#66d9ef">AS</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;fly&#39;</span> <span style="color:#66d9ef">AS</span> term, <span style="color:#ae81ff">2</span>.<span style="color:#ae81ff">0</span> <span style="color:#66d9ef">AS</span> title_weight, <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">0</span> <span style="color:#66d9ef">AS</span> desc_weight
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;flight&#39;</span>, <span style="color:#ae81ff">2</span>.<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;flying&#39;</span>, <span style="color:#ae81ff">2</span>.<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>),
</span></span><span style="display:flex;"><span>ranked <span style="color:#66d9ef">AS</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>        a.id,
</span></span><span style="display:flex;"><span>        a.title,
</span></span><span style="display:flex;"><span>        a.description,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">SUM</span>(
</span></span><span style="display:flex;"><span>            ((<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(a.title)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(a.title), k.term, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#66d9ef">LENGTH</span>(k.term)) <span style="color:#f92672">*</span> k.title_weight <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            ((<span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">LOWER</span>(a.description)) <span style="color:#f92672">-</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">LOWER</span>(a.description), k.term, <span style="color:#e6db74">&#39;&#39;</span>))) <span style="color:#f92672">/</span> <span style="color:#66d9ef">LENGTH</span>(k.term)) <span style="color:#f92672">*</span> k.desc_weight
</span></span><span style="display:flex;"><span>        ) <span style="color:#66d9ef">AS</span> rank
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FROM</span> archive_records a
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">CROSS</span> <span style="color:#66d9ef">JOIN</span> keywords k
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> a.id
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> id, title, description, rank
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ranked
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> rank <span style="color:#66d9ef">DESC</span>, id <span style="color:#66d9ef">ASC</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">5</span>;</span></span></code></pre></div></div>
<p>Here we have 2 CTEs now:</p>
<ul>
<li><code>keywords</code> defining the words to search for and its weight</li>
<li><code>ranked</code> defining the computed sum of weights with frequency on the relevant columns.</li>
</ul>
<p>As you can see, by just adding the keyword in the CTE along with its weight, the rest of the query can work without changing anything.</p>

<h3 class="relative group">Full Text Search
    <div id="full-text-search" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#full-text-search" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We can now also look at the <a href="https://sqlite.org/fts5.html"  target="_blank">FTS</a> or Full Text Search in SQLite.</p>
<p>In SQLite, we can create a <code>VIRTUAL TABLE</code> which is like</p>
<ul>
<li>A table computed on the fly</li>
<li>Doesn&rsquo;t exist as physical entity in the database</li>
</ul>
<p>We have <a href="https://sqlite.org/fts5.html"  target="_blank">fts5</a> which we can use to match, equality, or expressions in functions to search for text in columns.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> VIRTUAL <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> archive_fts <span style="color:#66d9ef">USING</span> fts5(
</span></span><span style="display:flex;"><span>    title, 
</span></span><span style="display:flex;"><span>    description,
</span></span><span style="display:flex;"><span>    content<span style="color:#f92672">=</span>archive_records
</span></span><span style="display:flex;"><span>);</span></span></code></pre></div></div>
<p>We need to provide the columns that we want to search against. In this case we want to search for <code>title</code> and <code>description</code> as the column. The <code>content=archive_records</code>, links the FTS table to a real table <code>archive_records</code> instead of storing its own copy of all text, the FTS table indexes the data from archive_records.</p>
<p>Then we want to insert all the records from the <code>archive_records</code> for it to make aware of the records existing in the actual table.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">IGNORE</span> <span style="color:#66d9ef">INTO</span> archive_fts(rowid, title, description)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> id, title, description <span style="color:#66d9ef">FROM</span> archive_records;</span></span></code></pre></div></div>
<p>Then we can query it like so:</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> archive_fts <span style="color:#66d9ef">WHERE</span> archive_fts <span style="color:#66d9ef">MATCH</span> <span style="color:#e6db74">&#39;fly&#39;</span>;</span></span></code></pre></div></div>
<p>We have a couple of option to search against like</p>
<ol>
<li>MATCH</li>
<li>Boolean Operator</li>
<li>Expressions and Wildcards</li>
</ol>
<p>We simply can filter the records with this</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> archive_fts
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> archive_records <span style="color:#66d9ef">ON</span> archive_fts.rowid <span style="color:#f92672">=</span> archive_records.id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> archive_fts <span style="color:#66d9ef">MATCH</span> <span style="color:#e6db74">&#39;fly OR flight OR flying&#39;</span>;</span></span></code></pre></div></div>
<p>We have added <code>MATCH 'fly OR flight OR flying'</code> to only limit the search space on those keywords.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    archive_records.id,
</span></span><span style="display:flex;"><span>    archive_records.title,
</span></span><span style="display:flex;"><span>    archive_records.description,
</span></span><span style="display:flex;"><span>    (
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> archive_records.title <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> archive_records.title <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> archive_records.title <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span> <span style="color:#66d9ef">THEN</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">END</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> archive_records.description <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%fly%&#39;</span> <span style="color:#66d9ef">OR</span> archive_records.description <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flight%&#39;</span> <span style="color:#66d9ef">OR</span> archive_records.description <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%flying%&#39;</span> <span style="color:#66d9ef">THEN</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">END</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">AS</span> rank
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> archive_fts
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> archive_records <span style="color:#66d9ef">ON</span> archive_fts.rowid <span style="color:#f92672">=</span> archive_records.id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> archive_fts <span style="color:#66d9ef">MATCH</span> <span style="color:#e6db74">&#39;fly OR flight OR flying&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> rank <span style="color:#66d9ef">DESC</span>, archive_records.id <span style="color:#66d9ef">ASC</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">5</span>;</span></span></code></pre></div></div>
<p>This simply will give us the relevant results by doing a fuzzy search which is way better then <code>LIKE</code> or <code>%</code> wildcard operators in the columns.</p>
<p>So, that are the approaches I like taking on day 12.</p>
<p>It was fun! Working with full text search for the first time.</p>
<p>On to day 13!</p>

          
          
          
        </div>
        
        
        

        

      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js"
          integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA=="
          data-oid="views_posts/2025-12-27-adevnt-of-sql-day-12-archive-flight-records.md"
          data-oid-likes="likes_posts/2025-12-27-adevnt-of-sql-day-12-archive-flight-records.md"></script>
      
    </section>

    
    <footer class="pt-8 max-w-prose print:hidden">
      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
      <div class="flex justify-between pt-3">
        <span class="flex flex-col">
          
            <a
              class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="/posts/techstructive-weekly-74/">
              <span class="leading-6">
                <span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Techstructive Weekly #74
              </span>
            </a>
            
              <span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2025-12-27T00:00:00&#43;00:00">December 27, 2025</time>
              </span>
            
          
        </span>
        <span class="flex flex-col items-end">
          
            <a
              class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="/posts/advent-of-sql-2025-day-13/">
              <span class="leading-6">
                Advent of SQL 2025 Day 13: XML Travel Manifests&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
              </span>
            </a>
            
              <span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2025-12-27T20:30:00&#43;05:30">December 27, 2025</time>
              </span>
            
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        


  






<div
  id="scroll-to-top"
  class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200">
  <a
    href="#the-top"
    class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2026
          Meet Gor
      </p>
    

    
    
      <p class="text-xs text-neutral-500 dark:text-neutral-400">
        
        
        Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
      </p>
    
  </div>
  
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  
  
  
  <script
    type="text/javascript"
    src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500"
  data-url="/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
