# Fixes Applied to Vercel SSG Deployment

## Issues Fixed

### 1. **YAML Front Matter Whitespace Parsing Error**
- **Problem**: Export tool was generating markdown files with tabs in YAML front matter, causing Hugo to fail with "EOF looking for end YAML front matter delimiter"
- **Fix**: Updated `cmd/export/main.go` to trim leading/trailing whitespace from post content using `strings.TrimSpace()`
- **Commit**: `fdbb731`

### 2. **Hugo Version Incompatibility with Blowfish Theme**
- **Problem**: Blowfish theme required Hugo 0.154.0+ extended, but older version was being used, causing "function 'try' not defined" template errors
- **Fix**: 
  - Updated Hugo binary to v0.154.0 extended
  - Verified `sync-posts-turso.yml` already specifies Hugo 0.154.0
  - Workflow now uses correct version automatically
- **Commit**: `589d883`

### 3. **Posts Not Showing on Homepage**
- **Problem**: Stack/Blowfish theme requires `mainSections` config to identify which sections to display
- **Fix**: Added `mainSections = ["posts"]` to `exports/hugo.toml`
- **Commit**: `589d883`

### 4. **No Post Type Separation in UI**
- **Problem**: Users couldn't distinguish between regular posts and link posts
- **Fix**: Created custom layout `exports/layouts/posts/list.html` that:
  - Automatically separates posts by `type` parameter
  - Shows "Posts" section for `type: "posts"`
  - Shows "Interesting Links" section for `type: "link"`
  - Groups items by year within each section
- **Commit**: `491912f`

## Current Setup

### Workflows
- **sync-posts-turso.yml**: Runs every 6 hours
  - Exports posts from Turso database
  - Builds Hugo site with Hugo 0.154.0 extended
  - Pushes to main (triggers deploy-vercel)
  
- **deploy-vercel.yml**: Triggered by pushes to `public/**`
  - Deploys SSG output from `public/` directory
  - Vercel serves only static files (no CMS)

### File Structure
- `exports/`: Hugo site source with Blowfish theme
- `exports/content/posts/`: Post markdown files generated by export tool
- `exports/layouts/posts/list.html`: Custom list template with type separation
- `public/`: Generated static site (deployed to Vercel)

## Testing Locally

```bash
# Build the site
cd exports
../hugo --minify --destination ../public

# Verify output
ls -la ../public/posts/
```

## Next Steps

The sync workflow will regenerate all post files from Turso database on next run (every 6 hours or manual trigger). Posts will automatically be categorized into Posts and Links sections based on their `type` field.
